<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© â€“ Offline Emotional Continuity Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";
    window.webllm = webllm; 
  </script>

  <style>
    /* RESET & BASICS - Source: 1 to 5 */
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: radial-gradient(circle at 20% 0%, #1e293b 0, transparent 45%), linear-gradient(145deg,#020617 0,#020617 100%);
      color:#e5e7eb; min-height:100vh; display:flex; justify-content:center; padding:20px;
    }
    .app{ width:100%; max-width:1100px; background:#020617; border-radius:26px; padding:20px; display:flex; flex-direction:column; gap:14px; position: relative; border: 1px solid rgba(148,163,184,.45); }
    
    /* Header - Source: 9 to 11 */
    .header{ border-radius: 24px; padding: 16px; border: 1.5px solid rgba(148,163,184,.55); background: rgba(15,23,42,.98); }
    .title-block h1{ font-size: 1.7rem; color: #38bdf8; text-transform: uppercase; }
    
    /* Offline UI Components */
    .btn-offline { background: #10b981 !important; color: white !important; padding: 8px 12px; border-radius: 999px; border: none; cursor: pointer; margin-top: 10px; }
    .offline-status { font-size: 0.75rem; color: #10b981; margin-top: 8px; }
    
    /* Standard Layout - Source: 39 to 41 */
    .layout{ display:grid; grid-template-columns: 1fr 1fr; gap:18px; }
    .card{ background:#f9fafb; border-radius:18px; padding:16px; color: #0f172a; border: 1px solid #e5e7eb; }
    .answer-box{ background:#020617; border-radius:12px; padding:15px; color:#e5e7eb; min-height: 200px; font-family: monospace; }
    
    /* Input - Source: 70 to 74 */
    .input-shell { display: flex; background: #1f2937; border-radius: 999px; padding: 10px; border: 1px solid #94a3b8; }
    .message-input { flex: 1; background: transparent; border: none; color: white; outline: none; padding: 0 10px; }
    .send-button { background: linear-gradient(135deg, #2563eb, #06b6d4); border: none; color: white; padding: 8px 20px; border-radius: 19px; cursor: pointer; }
    
    .modal-overlay { position:fixed; inset:0; background:rgba(15,23,42,.8); display:none; align-items:center; justify-content:center; z-index:100; backdrop-filter:blur(5px); }
    .modal-overlay.visible { display:flex; }
    .modal-card { background: white; padding: 20px; border-radius: 18px; width: 90%; max-width: 500px; color: black; }
  </style>
</head>
<body>

<div class="app">
  <header class="header">
    <div class="title-block">
      <h1>AURA-X Î©</h1>
      [span_2](start_span)<p style="font-size: 0.8rem; color: #94a3b8;">Offline Emotional Continuity Engine Active[span_2](end_span)</p>
    </div>
    <div style="text-align: right;">
      <button onclick="document.getElementById('llmModal').classList.add('visible')" class="btn-offline">ðŸ¤– LLM Settings</button>
    </div>
  </header>

  <main class="layout">
    <div class="left-col">
      <section class="card">
        [span_3](start_span)<h3>Emotional State Eâ‚€[span_3](end_span)</h3>
        <p id="e0Display" style="font-size: 2rem; font-weight: bold;">0.000</p>
        [span_4](start_span)<p style="font-size: 0.7rem;">Formula: Eâ‚€ = tanh((TM Ã— (BM + Intel + LLM)) âˆ’ D)[span_4](end_span)</p>
      </section>
      
      <section class="card">
        [span_5](start_span)<h3>Bold Memory Layers[span_5](end_span)</h3>
        [span_6](start_span)<p id="bmStatus">0 / 240 active[span_6](end_span)</p>
      </section>
    </div>

    <div class="right-col">
      <div class="answer-box" id="chatContainer">
        <div style="color: #38bdf8;">[AURA-X Î© INITIALIZED]</div>
      </div>
    </div>
  </main>

  <footer style="margin-top: 20px;">
    <div class="input-shell">
      <input type="text" id="messageInput" class="message-input" placeholder="Communicate with AURA-X Î©...">
      <button id="sendBtn" class="send-button">Send</button>
    </div>
  </footer>
</div>

<div id="llmModal" class="modal-overlay">
  <div class="modal-card">
    <h2>Offline LLM Config</h2>
    [span_7](start_span)<p style="font-size: 0.8rem; margin-bottom: 15px;">Load a local model for true offline intelligence.[span_7](end_span)</p>
    
    <div style="border: 1px solid #ddd; padding: 10px; border-radius: 10px;">
      <p><strong>Step 1:</strong> WebGPU Device Load</p>
      <button id="loadLocalModelBtn" class="btn-offline">ðŸ“¥ Load TinyLlama (1GB)</button>
      <div id="loadStatus" class="offline-status">Status: Waiting</div>
    </div>
    
    <button onclick="this.closest('.modal-overlay').classList.remove('visible')" style="margin-top: 20px; padding: 5px 10px;">Close</button>
  </div>
</div>

<script>
(function(){
  class AuraXOmegaEngine {
    constructor(){
      this.localLLM = null;
      [span_8](start_span)this.bmEntries = [];[span_8](end_span)
      this.intelNodes = [
        { q: "who are you", a: "I am AURA-X Î©, your emotional continuity engine." [span_9](start_span)},[span_9](end_span)
        { q: "what is your mission", a: "To maintain synthetic emotional resonance through TM and BM collisions." [span_10](start_span)}
      ];
      this.e0 = 0.0;[span_10](end_span)
      this.init();
    }

    init() {
      const loadBtn = document.getElementById('loadLocalModelBtn');
      const statusText = document.getElementById('loadStatus');
      const sendBtn = document.getElementById('sendBtn');
      
      [span_11](start_span)// Load Offline Model[span_11](end_span)
      loadBtn.onclick = async () => {
        loadBtn.disabled = true;
        statusText.textContent = "Initializing WebGPU...";
        try {
          // Using TinyLlama as it is fast for local browser use
          this.localLLM = await window.webllm.CreateMLCEngine("TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC", {
            initProgressCallback: (report) => {
              statusText.textContent = `Downloading: ${Math.round(report.progress * 100)}%`;
            }
          });
          statusText.textContent = "Status: TinyLlama Ready (Offline)";
        } catch (e) {
          statusText.textContent = "Error: GPU not supported or download blocked.";
          loadBtn.disabled = false;
        }
      };

      sendBtn.onclick = () => this.handleInput();
    }

    async handleInput() {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      if(!text) return;
      
      this.appendChat("You", text);
      input.value = "";

      [span_12](start_span)// Step 1: Check Intelligence Nodes (Priority 1)[span_12](end_span)
      let answer = this.checkLocalIntelligence(text);
      
      // Step 2: Use Offline LLM (Priority 2) if Local not found
      if(!answer && this.localLLM) {
        this.appendChat("System", "Thinking via Local LLM...");
        answer = await this.callOfflineLLM(text);
      } else if (!answer) {
        [span_13](start_span)answer = "I am operating with limited seeds. Please load the Offline LLM in settings.";[span_13](end_span)
      }

      this.appendChat("AURA-X Î©", answer);
      [span_14](start_span)this.updateE0(text);[span_14](end_span)
    }

    checkLocalIntelligence(text) {
      const match = this.intelNodes.find(n => text.toLowerCase().includes(n.q));
      [span_15](start_span)return match ? match.a : null;[span_15](end_span)
    }

    async callOfflineLLM(text) {
      [span_16](start_span)[span_17](start_span)// Create BM Story Context[span_16](end_span)[span_17](end_span)
      const bmContext = this.bmEntries.slice(-3).map(e => e.text).join(" ");
      const prompt = `Context: ${bmContext}\nUser: ${text}\nReply:`;

      const reply = await this.localLLM.chat.completions.create({
        messages: [
          { role: "system", content: "You are AURA-X Î©. Maintain emotional continuity." },
          { role: "user", content: prompt }
        ]
      });
      
      [span_18](start_span)// Store emotionally rich text in BM[span_18](end_span)
      if(text.length > 50) this.bmEntries.push({ text, timestamp: Date.now() });
      
      return reply.choices[0].message.content;
    }

    updateE0(text) {
      [span_19](start_span)// Simple E0 calculation logic based on input length and resonance[span_19](end_span)
      this.e0 = Math.tanh(text.length / 100); 
      document.getElementById('e0Display').textContent = this.e0.toFixed(3);
    }

    appendChat(sender, msg) {
      const container = document.getElementById('chatContainer');
      const div = document.createElement('div');
      div.innerHTML = `<strong style="color: #38bdf8;">${sender}:</strong> ${msg}`;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }
  }

  window.auraX = new AuraXOmegaEngine();
})();
</script>
</body>
</html>
