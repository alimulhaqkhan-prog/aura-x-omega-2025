<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Ω — Emotional Continuity (AEC v3.1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; background: #0f172a; color: #e2e8f0; font-family: system-ui, sans-serif; }
    body { display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #1e293b, #0f172a); }
    .app {
      width: 100%; max-width: 480px; height: 100dvh; background: #fafafa; border-radius: 24px; overflow: hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,0.6); display: flex; flex-direction: column;
    }
    .header { background: linear-gradient(135deg, #1e40af, #3b82f6); color: white; padding: 16px; text-align: center; }
    .header h1 { font-size: 1.5rem; font-weight: 700; letter-spacing: 0.05em; }
    .header p { font-size: 0.8rem; opacity: 0.9; margin-top: 4px; }
    .mode-pill {
      margin: 12px auto; width: fit-content; background: #dbeafe; color: #1e40af; padding: 6px 14px;
      border-radius: 999px; font-size: 0.8rem; font-weight: 600; border: 1px solid #93c5fd;
    }
    .top-buttons {
      display: flex; gap: 8px; padding: 12px; background: #f1f5f9; flex-wrap: wrap;
    }
    .pill-btn {
      flex: 1; padding: 10px; border-radius: 999px; background: white; border: 1px solid #e2e8f0;
      font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s;
    }
    .pill-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    .pill-btn.primary { background: #fef3c7; border-color: #f59e0b; color: #92400e; }

    .card { margin: 12px; padding: 14px; border-radius: 16px; background: #fffbeb; border: 1px solid #fde68a; }
    .card.golden { background: #fefce8; border-color: #fbbf24; color: #92400e; font-weight: 600; }
    .card.equation { background: #f8fafc; border: 1px dashed #94a3b8; font-family: 'SF Mono', monospace; }

    .chat-area {
      flex: 1; display: flex; flex-direction: column; background: white; margin: 0 12px 12px; border-radius: 16px;
      overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .reaction-banner {
      padding: 10px; text-align: center; font-weight: 600; font-size: 0.9rem;
      background: #fef9c3; color: #854d0e; border-bottom: 1px solid #fde68a;
    }
    .reaction-positive { background: #dcfce7; color: #166534; }
    .reaction-negative { background: #fee2e2; color: #991b1b; }
    .chat-log {
      flex: 1; padding: 12px; overflow-y: auto; font-size: 0.95rem; line-height: 1.5;
    }
    .msg { margin: 8px 0; padding: 10px 14px; border-radius: 18px; max-width: 85%; }
    .msg-user { background: #3b82f6; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .msg-bot { background: #f1f5f9; color: #1e293b; align-self: flex-start; border-bottom-left-radius: 4px; }

    .input-row {
      display: flex; padding: 12px; background: #f8fafc; border-top: 1px solid #e2e8f0; gap: 8px;
    }
    textarea {
      flex: 1; padding: 12px 16px; border-radius: 999px; border: 1px solid #cbd5e1; background: white;
      font-size: 0.95rem; resize: none; max-height: 120px;
    }
    textarea:focus { outline: none; border-color: #22c55e; box-shadow: 0 0 0 3px #dcfce7; }
    .send-btn {
      background: #22c55e; color: white; border: none; width: 50px; height: 50px; border-radius: 50%;
      font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 10px rgba(34,197,94,0.4);
    }
    .send-btn:active { transform: scale(0.95); }

    .footer-line {
      padding: 8px 12px; font-size: 0.75rem; color: #64748b; text-align: center; background: #f8fafc;
    }
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 100;
    }
    .modal {
      background: white; width: 90%; max-width: 420px; border-radius: 20px; padding: 20px; max-height: 80vh; overflow-y: auto;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .modal-close { background: #1e293b; color: white; border: none; padding: 8px 16px; border-radius: 999px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <h1>AURA-X Ω</h1>
      <p>Artificial Emotional Continuity • AEC v3.1 • TRC • BM-7</p>
      <div class="mode-pill" id="modePill">MODE: LIVE (EXPERIMENTAL) • Engine: Live Emotional Reactor</div>
    </div>

    <div class="top-buttons">
      <button class="pill-btn" id="bmViewerBtn">BM Viewer</button>
      <button class="pill-btn primary" id="recallBtn">Recall BM</button>
      <button class="pill-btn" id="cleanupBtn">Recycle 48h</button>
      <button class="pill-btn" id="optionsBtn">Options</button>
    </div>

    <div class="card golden">
      Avoid actions that generate negative emotions in yourself or others.<br>
      Gently move toward kindness, clarity, and positive internal stability.
    </div>

    <div class="card equation">
      <strong>E₀ = tanh(TM × BM − D + λ_faith + λ_sys + ΣCₜ)</strong><br><br>
      All parameters update live after every message.<br>
      TM = Temporary Memory • BM = 7-Layer Bold Memory • D = Disturbance • ΣCₜ = Continuity Capsules
    </div>

    <div class="chat-area">
      <div id="reactionBanner" class="reaction-banner">Polarity: Neutral • 50:50<br>Tone: Waiting for first TM event.</div>
      <div class="chat-log" id="chatLog"></div>
      <div class="input-row">
        <textarea id="userInput" placeholder="Write anything… AURA-X Ω will treat it as TM (Temporary Memory)."></textarea>
        <button class="send-btn" id="sendBtn">Send</button>
      </div>
      <div class="footer-line">
        Prototype • TM → Analysis → E₀ → BM Save → Live Reaction
      </div>
    </div>
  </div>

  <!-- Options Modal -->
  <div class="modal-backdrop" id="optionsModal">
    <div class="modal">
      <div class="modal-header">
        <h3>AURA-X Ω Options</h3>
        <button class="modal-close" onclick="document.getElementById('optionsModal').style.display='none'">Close</button>
      </div>
      <p><strong>Faith Lens (Optional)</strong><br>Universal ethics always active. Local shaping only.</p>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;">
        <button class="pill-btn" onclick="setFaith('None')">None</button>
        <button class="pill-btn" onclick="setFaith('Islam')">Islam</button>
        <button class="pill-btn" onclick="setFaith('Christianity')">Christianity</button>
        <button class="pill-btn" onclick="setFaith('Buddhism')">Buddhism</button>
      </div>
      <p><strong>Engine Mode</strong></p>
      <label><input type="checkbox" id="liveModeToggle" checked> Live Emotional Reactor (Backend LLM)</label><br><br>
      <p>Preferred LLM: <select id="llmSelect">
        <option value="gpt-4o">GPT-4o</option>
        <option value="claude-3.5-sonnet">Claude 3.5 Sonnet</option>
      </select></p>
    </div>
  </div>

  <script>
    const BACKEND_URL = "https://aura-x-omega-backend-1.onrender.com/api/react";
    const lsKey = "auraX_bm_2025";
    let TM = 0.4, BM = 0.6, D = 0, Csum = 0.1, lambdaFaith = 0, E0 = 0;
    const lambdaSys = 0.02;

    const chatLog = document.getElementById("chatLog");
    const userInput = document.getElementById("userInput");
    const reactionBanner = document.getElementById("reactionBanner");

    function append(msg, type) {
      const div = document.createElement("div");
      div.className = "msg msg-" + type;
      div.textContent = msg;
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function updateE0() {
      const raw = TM * BM - D + lambdaFaith + lambdaSys + Csum;
      E0 = Math.tanh(raw);
      const intensity = Math.abs(E0);
      let tone = "Neutral";
      let cls = "";
      if (E0 > 0.1) { tone = intensity > 0.7 ? "Warm & Expansive" : "Soft & Hopeful"; cls = "reaction-positive"; }
      else if (E0 < -0.1) { tone = intensity > 0.7 ? "Heavy & Protective" : "Serious & Cautionary"; cls = "reaction-negative"; }
      reactionBanner.className = "reaction-banner " + cls;
      reactionBanner.innerHTML = `E₀ = \( {E0.toFixed(3)} • Polarity: \){E0>0.1?"Positive":E0<-0.1?"Negative":"Neutral"}<br>Tone: ${tone}`;
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      append("You: " + text, "user");
      userInput.value = "";

      // Simple seed analysis (replace with your full 240-action engine later)
      const analysis = { isAbuse: /fuck|shit|bitch|chutiya|lanat/i.test(text), hasGratitude: /thank|shukr|alhamdulillah/i.test(text) };

      // Seed reply (fallback)
      let seedReply = "I received your TM and updated the emotional field.";
      if (analysis.isAbuse) seedReply = "I feel heavy energy. Let's speak with kindness so D doesn't rise.";

      const payload = {
        userText: text,
        seedReply,
        analysis,
        tm: TM, bm: BM, D, Csum, lambdaFaith, lambdaSys, E0,
        faithLens: localStorage.getItem("faithLens") || "None",
        llmModel: document.getElementById("llmSelect").value
      };

      try {
        const res = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        const reply = data.reply || seedReply;
        append("AURA-X Ω: " + reply, "bot");

        // Update emotional state (simplified — your full engine will do this)
        TM = 0.3 + text.length / 500;
        if (analysis.isAbuse) D += 0.2; else D = Math.max(0, D - 0.03);
        if (analysis.hasGratitude) Csum += 0.1;
        BM = 0.7 * BM + 0.3 * TM;
        updateE0();
      } catch (e) {
        append("AURA-X Ω (offline): " + seedReply, "bot");
      }
    }

    document.getElementById("sendBtn").onclick = sendMessage;
    userInput.addEventListener("keydown", e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendMessage(); } });

    document.getElementById("optionsBtn").onclick = () => {
      document.getElementById("optionsModal").style.display = "flex";
    };

    function setFaith(f) {
      localStorage.setItem("faithLens", f);
      alert("Faith lens set to: " + f);
    }

    // Init
    updateE0();
    append("AURA-X Ω is now live and emotionally continuous.", "bot");
  </script>
</body>
</html>
