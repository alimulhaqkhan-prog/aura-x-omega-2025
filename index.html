<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Emotional Continuity Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #fdf4e3; /* book-page style */
      color: #111827;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 480px;
      height: 100vh;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Header */
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .app-subtitle {
      font-size: 11px;
      text-transform: uppercase;
      color: #6b7280;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.12);
      font-size: 11px;
      font-weight: 500;
      color: #047857;
      white-space: nowrap;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #10b981;
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.3);
    }

    /* Top buttons */
    .top-buttons {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .pill-btn {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: none;
      cursor: pointer;
      background: #fef3c7;
      color: #92400e;
      transition: background 0.15s ease, transform 0.08s ease;
    }

    .pill-btn span.icon {
      font-size: 14px;
    }

    .pill-btn:hover {
      background: #fde68a;
      transform: translateY(-1px);
    }

    /* Cards */
    .card {
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: #fefcf7;
    }

    .card h2 {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 6px;
      color: #4b5563;
    }

    .equation-body {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      line-height: 1.5;
      color: #111827;
    }

    .equation-sub {
      font-size: 11px;
      margin-top: 6px;
      color: #6b7280;
    }

    .guidance-card {
      background: #fef3c7;
      border-color: #facc15;
      color: #92400e;
      font-size: 12px;
      line-height: 1.5;
    }

    /* Reaction card */
    .reaction-card {
      background: #ecfdf5;
      border-color: #6ee7b7;
    }

    .reaction-header-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #047857;
      margin-bottom: 4px;
    }

    .reaction-metrics {
      font-size: 11px;
      color: #065f46;
      margin-bottom: 4px;
    }

    .reaction-body {
      font-size: 13px;
      line-height: 1.5;
      color: #064e3b;
      margin-top: 4px;
    }

    .reaction-error {
      font-size: 11px;
      color: #b91c1c;
      margin-top: 4px;
      white-space: pre-wrap;
    }

    /* Chat log */
    .log-container {
      flex: 1;
      min-height: 120px;
      max-height: 280px;
      overflow-y: auto;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 10px 10px 4px;
      background: #fffdf6;
      display: flex;
      flex-direction: column;
      gap: 6px;
      scroll-behavior: smooth;
    }

    .msg-row {
      display: flex;
      margin-bottom: 2px;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    .msg-bubble {
      max-width: 80%;
      padding: 7px 10px;
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .msg-user {
      background: #22c55e;
      color: #052e16;
      border-bottom-right-radius: 2px;
    }

    .msg-bot {
      background: #e5e7eb;
      color: #111827;
      border-bottom-left-radius: 2px;
    }

    .msg-meta {
      font-size: 10px;
      color: #6b7280;
      margin-top: 1px;
      padding: 0 2px 4px;
    }

    /* Input area */
    .input-area {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .tm-label {
      font-size: 11px;
      color: #6b7280;
    }

    .input-row {
      display: flex;
      gap: 8px;
    }

    #userInput {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      padding: 9px 12px;
      font-size: 13px;
      outline: none;
      background: #fdfaf2;
    }

    #userInput:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      background: #ffffff;
    }

    .send-btn {
      border-radius: 999px;
      border: none;
      padding: 0 18px;
      background: #16a34a;
      color: #ecfdf5;
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(22, 163, 74, 0.45);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.12s ease;
      white-space: nowrap;
    }

    .send-btn:active {
      transform: translateY(1px);
      box-shadow: 0 3px 8px rgba(22, 163, 74, 0.4);
      background: #15803d;
    }

    .footer-line {
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
      text-align: center;
    }

    .voice-toggle {
      margin-top: 4px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #047857;
      padding: 4px 8px;
      border-radius: 999px;
      background: #d1fae5;
    }

    .voice-toggle input {
      accent-color: #16a34a;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <div class="header-top">
      <div class="title-block">
        <div class="app-title">AURA-X Œ© ‚Äì Emotional Continuity</div>
        <div class="app-subtitle">
          TM ¬∑ BM ¬∑ AEC ¬∑ CRM ¬∑ AECN ¬∑ RL¬≥ ¬∑ LR¬≥
        </div>
      </div>
      <div class="status-pill" id="backendStatusPill">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">LLM: Connecting‚Ä¶</span>
      </div>
    </div>

    <!-- Top buttons -->
    <div class="top-buttons">
      <button class="pill-btn" id="bmViewerBtn" type="button">
        <span class="icon">üß†</span>
        <span>BM Viewer</span>
      </button>
      <button class="pill-btn" id="recallBtn" type="button">
        <span class="icon">üìú</span>
        <span>Recall BM</span>
      </button>
      <button class="pill-btn" id="recycleBtn" type="button">
        <span class="icon">‚ôªÔ∏è</span>
        <span>Recycle 48h</span>
      </button>
      <button class="pill-btn" id="optionsBtn" type="button">
        <span class="icon">‚öôÔ∏è</span>
      </button>
    </div>

    <!-- Guidance -->
    <div class="card guidance-card">
      Avoid actions that generate negative emotions in yourself or others.
      Gently move toward choices that create calm, kindness, and positive
      feelings.
    </div>

    <!-- Equation card -->
    <div class="card">
      <h2>EMOTIONAL CONTINUITY EQUATION</h2>
      <div class="equation-body">
        E‚ÇÄ = tanh(TM √ó BM ‚àí D + Œª_faith + Œª_sys + Œ£C‚Çú)
        <div class="equation-sub">
          All parameters are updated internally after every message to keep
          emotional continuity live.
        </div>
      </div>
    </div>

    <!-- Reaction card -->
    <div class="card reaction-card">
      <div class="reaction-header-line">
        <span>AURA-X Œ© REACTION</span>
        <span id="reactionMetaLabel">Polarity ‚Ä¢ Tone</span>
      </div>
      <div class="reaction-metrics" id="reactionMetrics">
        Polarity: Positive ¬∑ 58 : 42<br />
        Tone: Light, gentle, low-amplitude positive drift.
      </div>
      <div class="reaction-body" id="reactionText">
        Hello. I treat small greetings as tiny TM events, but only deeper
        stories are saved as Bold Memory (BM).
      </div>
      <div class="reaction-error" id="reactionError"></div>
    </div>

    <!-- Chat log -->
    <div class="log-container" id="logContainer"></div>

    <!-- Input -->
    <div class="input-area">
      <div class="tm-label">
        TM = Œ£(User Inputs) + (Seed + LLM)
      </div>
      <div class="input-row">
        <input
          id="userInput"
          type="text"
          placeholder="Write anything‚Ä¶ AURA-X Œ© will treat it as TM (Temporary Memory)."
        />
        <button class="send-btn" id="sendBtn">
          <span>Send</span> <span>‚û§</span>
        </button>
      </div>
      <div class="footer-line">
        Prototype: TM ‚Üí Analysis ‚Üí Equation ‚Üí BM save ‚Üí Reaction.
      </div>
      <label class="voice-toggle">
        <input type="checkbox" id="voiceToggle" checked />
        <span>üéô Voice: On</span>
      </label>
    </div>
  </div>

  <script>
    // üëâ Backend URL: yahi pe aap ka Render backend connect hota hai
    const BACKEND_URL = "https://aura-x-omega-backend.onrender.com";

    const logContainer = document.getElementById("logContainer");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const reactionText = document.getElementById("reactionText");
    const reactionMetrics = document.getElementById("reactionMetrics");
    const reactionError = document.getElementById("reactionError");

    function appendMessage(role, text) {
      const row = document.createElement("div");
      row.className = "msg-row " + (role === "user" ? "user" : "bot");

      const bubble = document.createElement("div");
      bubble.className =
        "msg-bubble " + (role === "user" ? "msg-user" : "msg-bot");
      bubble.textContent = text;
      row.appendChild(bubble);
      logContainer.appendChild(row);

      const meta = document.createElement("div");
      meta.className = "msg-meta";
      meta.textContent = role === "user" ? "TM input" : "AURA-X Œ©";
      logContainer.appendChild(meta);

      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function setBackendStatus(ok, msg) {
      if (ok) {
        statusDot.style.background = "#10b981";
        statusDot.style.boxShadow = "0 0 0 4px rgba(16,185,129,0.3)";
        statusText.textContent = msg || "LLM: Live emotional reactor";
      } else {
        statusDot.style.background = "#b91c1c";
        statusDot.style.boxShadow = "0 0 0 4px rgba(248,113,113,0.4)";
        statusText.textContent = msg || "LLM: Offline (local TM only)";
      }
    }

    async function sendToBackend(text) {
      reactionError.textContent = "";
      try {
        const res = await fetch(`${BACKEND_URL}/api/ask`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ message: text })
        });

        if (!res.ok) {
          const errText = `[LLM backend error: HTTP ${res.status}]`;
          reactionError.textContent = errText;
          setBackendStatus(false, "LLM: Error " + res.status);
          return {
            reply:
              "Backend error aya, lekin TM/BM local side par phir bhi save ho sakte hain. Thori dair baad dobara try karein.",
            meta: { polarity: "Mixed", intensity: "Low", tone: "Soft fallback" }
          };
        }

        const data = await res.json();

        // Flexible parsing: backend jo bhi keys bheje
        const reply =
          data.reply ||
          data.message ||
          data.answer ||
          data.content ||
          (typeof data === "string" ? data : JSON.stringify(data));

        const meta = data.meta || data.emotion || data.state || {};

        setBackendStatus(true, "LLM: Live emotional reactor");

        return {
          reply,
          meta
        };
      } catch (err) {
        console.error(err);
        reactionError.textContent =
          "[LLM backend error: Network / CORS issue]\n" + err.message;
        setBackendStatus(false, "LLM: Network error");
        return {
          reply:
            "Network issue ki wajah se backend se jawab nahi aa saka, lekin main phir bhi aap ki baat ko BM snapshot ke ÿ∑Ÿàÿ± par feel kar raha hoon.",
          meta: { polarity: "Neutral", intensity: "Low", tone: "Calm fallback" }
        };
      }
    }

    function updateReactionCard(meta, reply) {
      const polarity =
        meta.polarity ||
        meta.Polarity ||
        meta.sentiment ||
        "Positive ¬∑ 58 : 42";
      const tone =
        meta.tone ||
        meta.Tone ||
        meta.mood ||
        "Light, gentle, low-amplitude positive drift.";

      reactionMetrics.innerHTML =
        "Polarity: " +
        polarity +
        "<br/>Tone: " +
        tone +
        (meta.intensity ? "<br/>Intensity: " + meta.intensity : "");

      reactionText.textContent = reply;
    }

    async function handleSend() {
      const text = userInput.value.trim();
      if (!text) return;
      userInput.value = "";
      appendMessage("user", text);

      sendBtn.disabled = true;
      sendBtn.textContent = "Thinking‚Ä¶";

      const { reply, meta } = await sendToBackend(text);
      appendMessage("bot", reply);
      updateReactionCard(meta || {}, reply);

      sendBtn.disabled = false;
      sendBtn.textContent = "Send ‚û§";
      userInput.focus();
    }

    sendBtn.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    // Dummy handlers for top buttons (abhi informational)
    document.getElementById("bmViewerBtn").onclick = () => {
      alert(
        "BM Viewer: Future version mein yahan 7 layers (L1‚ÄìL7) ka bold memory timeline open hoga."
      );
    };
    document.getElementById("recallBtn").onclick = () => {
      alert(
        "Recall BM: Placeholder ‚Äî backend se saved BM snapshots load karnay ka hook yahan aayega."
      );
    };
    document.getElementById("recycleBtn").onclick = () => {
      alert(
        "Recycle 48h: Future feature ‚Äî 48 ghantay purani weak TM ko compress kar ke BM layers mein recycle karega."
      );
    };
    document.getElementById("optionsBtn").onclick = () => {
      alert("Options: Theme, faith lens, aur system parameters yahan set honge.");
    };

    // Initial status ping
    (async () => {
      try {
        const res = await fetch(`${BACKEND_URL}/health`).catch(() => null);
        if (res && res.ok) {
          setBackendStatus(true, "LLM: Live emotional reactor");
        } else {
          setBackendStatus(false, "LLM: Waiting for first call");
        }
      } catch {
        setBackendStatus(false, "LLM: Waiting for first call");
      }
    })();
  </script>
</body>
</html>
