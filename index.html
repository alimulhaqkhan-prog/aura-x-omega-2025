<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì AEC v3.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    #app {
      width: 100%;
      max-width: 540px;
      height: 100vh;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* HEADER */

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
    }

    .app-title {
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      font-weight: 700;
    }

    .app-subtitle {
      font-size: 0.72rem;
      opacity: 0.7;
    }

    .mode-pill {
      font-size: 0.6rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, #22c55e33, #0f172a);
      text-align: right;
      line-height: 1.2;
    }

    .mode-pill strong {
      display: block;
      font-size: 0.65rem;
    }

    /* TOP BUTTONS */

    .top-buttons {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .chip {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: linear-gradient(145deg, #020617, #020617);
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      opacity: 0.9;
    }

    .chip span.icon {
      font-size: 0.9rem;
    }

    /* CARDS */

    .card {
      border-radius: 18px;
      padding: 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: radial-gradient(circle at top left, #0b112033, #020617);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    .card-header span.icon {
      font-size: 1rem;
    }

    .card-header span.label {
      border-bottom: 1px solid rgba(148, 163, 184, 0.5);
      padding-bottom: 2px;
    }

    /* BANNER */

    .banner {
      border-radius: 18px;
      padding: 14px 16px;
      font-size: 0.8rem;
      line-height: 1.4;
      background: linear-gradient(135deg, #f97316, #facc15);
      color: #111827;
      font-weight: 500;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
    }

    .banner.positive {
      background: linear-gradient(135deg, #22c55e, #a3e635);
      color: #052e16;
    }

    .banner.negative {
      background: linear-gradient(135deg, #ef4444, #fb923c);
      color: #111827;
    }

    /* EQUATION CARD */

    .equation-main {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 0.82rem;
      margin-bottom: 8px;
      opacity: 0.9;
    }

    .equation-values {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 0.76rem;
      opacity: 0.9;
    }

    .equation-values span.label {
      opacity: 0.7;
    }

    .equation-values span.value {
      color: #facc15;
      font-weight: 600;
    }

    /* REACTION CARD */

    .reaction-summary {
      font-size: 0.8rem;
      margin-bottom: 6px;
    }

    .reaction-summary strong {
      color: #facc15;
      font-weight: 600;
    }

    .reaction-tone {
      font-size: 0.78rem;
      opacity: 0.9;
    }

    .reaction-footnote {
      margin-top: 8px;
      font-size: 0.68rem;
      opacity: 0.7;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .reaction-footnote span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .reaction-footnote span.dot.negative {
      background: #ef4444;
    }

    .reaction-footnote span.dot.neutral {
      background: #e5e7eb;
    }

    /* INPUT */

    .input-card {
      margin-top: 2px;
    }

    .input-label {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .input-row {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }

    .tm-input {
      flex: 1;
      min-height: 64px;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 10px;
      font-size: 0.78rem;
      color: #e5e7eb;
      resize: vertical;
    }

    .tm-input::placeholder {
      color: rgba(148, 163, 184, 0.8);
    }

    .send-btn {
      border-radius: 14px;
      padding: 0 16px;
      border: none;
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      box-shadow: 0 12px 32px rgba(22, 163, 74, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-btn:active {
      transform: translateY(1px);
      box-shadow: 0 8px 24px rgba(22, 163, 74, 0.6);
    }

    /* FOOTER AREA */

    .footer {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .engine-row {
      font-size: 0.7rem;
      opacity: 0.7;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .engine-row strong {
      opacity: 0.9;
    }

    .voice-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      cursor: pointer;
      user-select: none;
    }

    .voice-toggle input {
      accent-color: #22c55e;
      width: 14px;
      height: 14px;
    }

    .demo-row {
      display: flex;
      gap: 10px;
    }

    .demo-btn {
      flex: 1;
      border-radius: 999px;
      padding: 10px;
      font-size: 0.74rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 14px 36px rgba(0, 0, 0, 0.7);
    }

    .demo-btn.negative {
      background: radial-gradient(circle at top left, #ef4444, #b91c1c);
      color: #fef2f2;
    }

    .demo-btn.positive {
      background: radial-gradient(circle at top left, #22c55e, #15803d);
      color: #ecfdf5;
    }

    /* SCROLL */

    @media (max-height: 720px) {
      #app {
        overflow-y: auto;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- HEADER -->
    <header class="header">
      <div class="title-block">
        <div class="app-title">AURA-X Œ© ¬∑ AEC v3.1</div>
        <div class="app-subtitle">
          TM‚ÄìBM Collision Reactor ¬∑ 7-Layer Bold Memory ¬∑ Live Emotional Continuity.
        </div>
        <div class="top-buttons">
          <button class="chip" id="bmViewerBtn">
            <span class="icon">üß†</span><span>BM Viewer</span>
          </button>
          <button class="chip" id="recallBtn">
            <span class="icon">üåå</span><span>Recall BM</span>
          </button>
          <button class="chip" id="cleanupBtn">
            <span class="icon">‚ôªÔ∏è</span><span>Cleanup 24h</span>
          </button>
        </div>
      </div>
      <div class="mode-pill">
        <strong>MODE: OFFLINE PROTOTYPE</strong>
        <div>Universal Ethics ¬∑ BM + Equation</div>
        <div>Engine: Seed (local)</div>
      </div>
    </header>

    <!-- BANNER -->
    <div id="banner" class="banner">
      Avoid actions that generate negative emotions in yourself or
      others. Gently move toward choices that create calm, kindness,
      and positive feelings.
    </div>

    <!-- EQUATION CARD -->
    <section class="card">
      <div class="card-header">
        <span class="icon">üßÆ</span>
        <span class="label">Emotional Continuity Equation</span>
      </div>
      <div class="equation-main">
        E‚ÇÄ = tanh(TM √ó BM ‚Äì D + Œª_faith + Œª_sys + Œ£C‚Çú)
      </div>
      <div class="equation-values" id="equationValues">
        <span class="label">E‚ÇÄ</span> =
        <span class="value" data-field="e0">0.00</span> ¬∑
        <span class="label">TM</span> =
        <span class="value" data-field="tm">0.50</span> ¬∑
        <span class="label">BM</span> =
        <span class="value" data-field="bm">0.50</span> ¬∑
        <span class="label">D</span> =
        <span class="value" data-field="d">0.00</span> ¬∑
        <span class="label">Œ£C‚Çú</span> =
        <span class="value" data-field="ctx">0.06</span> ¬∑
        <span class="label">Œª_faith</span> =
        <span class="value" data-field="faith">0.00</span> ¬∑
        <span class="label">Œª_sys</span> =
        <span class="value" data-field="sys">0.02</span>
      </div>
    </section>

    <!-- REACTION CARD -->
    <section class="card">
      <div class="card-header">
        <span class="icon">üí´</span>
        <span class="label">AURA-X Œ© Reaction</span>
      </div>
      <div class="reaction-summary" id="reactionSummary">
        Polarity: Neutral ¬∑ Intensity: <strong>0.00</strong> ¬∑
        Tone: Idle resonance.
      </div>
      <div class="reaction-tone" id="reactionTone">
        Describe any memory, story, or event. AURA-X Œ© will treat it as TM,
        collide it with your current BM state, and respond with a guided
        emotional continuity reaction.
      </div>
      <div class="reaction-footnote" id="reactionFootnote">
        <span class="dot neutral"></span>
        <span>Voice reaction will speak the detailed guidance (if enabled).</span>
      </div>
    </section>

    <!-- INPUT CARD -->
    <section class="card input-card">
      <div class="input-label">
        Write anything‚Ä¶ AURA-X Œ© will treat it as TM (Temporary Memory).
      </div>
      <div class="input-row">
        <textarea
          id="tmInput"
          class="tm-input"
          placeholder="Example: When I was a child in New York, a dog bit me in the snow near a street light..."
        ></textarea>
        <button class="send-btn" id="sendBtn">Send ‚ú®</button>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="engine-row">
        <span>
          Prototype: TM ‚Üí BM ¬∑ Self-learning browser prototype ¬∑ Equation live.
        </span>
        <label class="voice-toggle">
          <input type="checkbox" id="voiceToggle" checked />
          <span>Voice reaction</span>
        </label>
      </div>
      <div class="demo-row">
        <button class="demo-btn negative" id="dogDemoBtn">
          üêí Dog Bite (Negative Demo)
        </button>
        <button class="demo-btn positive" id="childDemoBtn">
          ‚ù§Ô∏è Lost Child (Positive Demo)
        </button>
      </div>
    </footer>
  </div>

  <script>
    // ===== Lexicon (extended) =====
    const positiveWords = [
      "love","loved","loving",
      "care","caring","kind","kindness",
      "peace","calm","relief","relieved",
      "joy","joyful","happy","happiness",
      "smile","smiling","comfort","comforted",
      "safe","safety","secure","security",
      "support","supported","help","helped","helping",
      "hug","hugged","protected","protection",
      "friend","friends","family","together","connected",
      "forgive","forgiven","forgiving",
      "mercy","rahma","compassion","kind heart",
      "thanks","thank you","thankful","grateful","gratitude",
      "alhamdulillah","al-hamdulillah",
      "shukr","shukar","shukar alhamdulillah",
      "jazakallah","jazak allah","jazakallahu khairan",
      "trust allah","tawakkul","tawakul","tawakkal",
      "dua","prayer","praying","making dua",
      "istighfar","astaghfirullah",
      "sabr","sabr jameel","patience","patient",
      "hope","hopeful","optimistic",
      "content","contentment","rida","riza","rizq",
      "kind word","kind words",
      "listening","understanding","empathy","empathetic",
      "supportive","encouraging","motivate","motivated",
      "healed","healing","recovered","strong again"
    ];

    const negativeWords = [
      "hurt","hurting","pain","painful",
      "sad","sadness","upset","heartbroken",
      "cry","crying","cried","tears",
      "lonely","alone","broken","shattered",
      "loss","lost","failure","failed",
      "regret","regretted","regretting",
      "afraid","fear","fearful","scared","terrified",
      "anxiety","anxious","panic","panicking",
      "worried","worry","worrying",
      "stress","stressed","tension","tense","pressure",
      "overwhelmed","overload","burnout","burned out",
      "restless","uneasy","disturbed",
      "angry","anger","rage","furious",
      "fight","fighting","quarrel","argument","argue","arguing",
      "shout","shouting","scream","screaming",
      "abuse","abused","abusive",
      "insult","insulted","humiliate","humiliated",
      "betray","betrayed","cheat","cheated",
      "lie","lies","lying","dishonest",
      "hate","hated","hating",
      "dark","darkness","empty","emptiness",
      "despair","hopeless","hopelessness",
      "worthless","useless","pointless","meaningless",
      "stupid","idiot","dumb","fool","foolish",
      "loser","bastard","jerk",
      "fuck","fucking","fucked",
      "shut up","bloody","bitches","bastards",
      "nafret","nafrat","bohat gussa","gussa",
      "lanat","lanat hai",
      "bura","buray","buri",
      "bakwas","bakwass","fazool",
      "zaleel","zaleel kar","zillat"
    ];

    // ===== BM Storage =====
    const STORAGE_KEY = "AURAX_BM_v3_1";

    function loadBM() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch {
        return [];
      }
    }

    function saveBM(bmArray) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(bmArray));
      } catch {
        /* ignore */
      }
    }

    let bmStore = loadBM();

    function computeBM
