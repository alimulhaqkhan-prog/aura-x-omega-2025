<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AURA-X Î© â€“ Offline Emotional Continuity Prototype</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* =========================
   CODE-2 UI (UNCHANGED)
========================= */
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at 20% 0%, #1e293b 0, transparent 45%),
    radial-gradient(circle at 80% 0%, #0ea5e9 0, transparent 40%),
    linear-gradient(145deg,#020617 0,#020617 100%);
  color:#e5e7eb;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.app{
  width:420px;
  background:rgba(2,6,23,.9);
  border-radius:16px;
  box-shadow:0 30px 80px rgba(0,0,0,.6);
  overflow:hidden;
}
.header{
  padding:14px;
  text-align:center;
  font-weight:600;
  letter-spacing:.5px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.chat{
  padding:14px;
  height:420px;
  overflow-y:auto;
}
.msg{
  margin-bottom:10px;
  padding:10px 12px;
  border-radius:10px;
  max-width:85%;
  line-height:1.4;
}
.user{background:#0ea5e9;color:#020617;margin-left:auto}
.bot{background:#111827}
.input{
  display:flex;
  border-top:1px solid rgba(255,255,255,.08);
}
input{
  flex:1;
  padding:12px;
  background:transparent;
  border:none;
  color:#fff;
  outline:none;
}
button{
  padding:12px 16px;
  background:#0ea5e9;
  border:none;
  cursor:pointer;
  color:#020617;
  font-weight:600;
}
.options{
  display:flex;
  gap:6px;
  padding:10px;
  border-top:1px solid rgba(255,255,255,.05);
}
.opt{
  flex:1;
  background:#020617;
  border:1px solid rgba(255,255,255,.1);
  color:#e5e7eb;
  padding:8px;
  font-size:12px;
  cursor:pointer;
}
.formula{
  font-size:11px;
  padding:8px;
  text-align:center;
  opacity:.7;
  border-top:1px dashed rgba(255,255,255,.1);
}
.locked{opacity:.6}
</style>
</head>

<body>
<div class="app">
  <div class="header">AURA-X Î© â€” Emotional Continuity</div>

  <div id="chat" class="chat"></div>

  <div class="options">
    <button class="opt" onclick="toggleLLM()">LLM</button>
    <button class="opt" onclick="clearTM()">Clear TM</button>
    <button class="opt" onclick="showBM()">BM</button>
  </div>

  <div class="input">
    <input id="inp" placeholder="Type here..." />
    <button onclick="send()">Send</button>
  </div>

  <div class="formula">
    Eâ‚€ = tanh( R(TM,BM) + I(TM) + I<sub>intel</sub> + I<sub>LLM</sub> âˆ’ D + Î»<sub>faith</sub> + Î»<sub>sys</sub> + Î»<sub>trc</sub> )
  </div>
</div>

<script>
/* =========================
   MEMORY STRUCTURE
========================= */
const TM = [];
let BM = JSON.parse(localStorage.getItem("BM")||"[]");
const BM_MAX_AGE = 30 * 24 * 60 * 60 * 1000; // 30 days

let llmEnabled = false;

/* =========================
   UI HELPERS
========================= */
function addMsg(text, cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

/* =========================
   BM MAINTENANCE
========================= */
function maintainBM(){
  const now=Date.now();
  BM.forEach(b=>{
    if(b.count>1) b.locked=true;
  });
  BM = BM.filter(b=> b.locked || (now - b.time < BM_MAX_AGE));
  localStorage.setItem("BM",JSON.stringify(BM));
}

/* =========================
   RESONANCE FORMULA
========================= */
function R(TM,BM){
  if(!BM.length) return 0;
  return TM.length / BM.length;
}

function computeE0(){
  const I_TM = TM.length * 0.2;
  const I_intel = 0.3;
  const I_LLM = llmEnabled ? 0.4 : 0;
  const D = 0.2;
  const lambda_faith = 0.2;
  const lambda_sys = 0.2;
  const lambda_trc = 0.2;

  const x = R(TM,BM) + I_TM + I_intel + I_LLM - D
            + lambda_faith + lambda_sys + lambda_trc;
  return Math.tanh(x);
}

/* =========================
   CORE LOGIC
========================= */
function send(){
  const v=inp.value.trim();
  if(!v) return;
  inp.value="";
  addMsg(v,"user");

  TM.push(v);

  let bm = BM.find(b=>b.text===v);
  if(bm){
    bm.count++;
    bm.locked=true;
  }else{
    BM.push({text:v,time:Date.now(),count:1,locked:false});
  }

  maintainBM();

  const E0 = computeE0();

  let reply;
  if(E0 > 0.6){
    reply = "Understood with high resonance.";
  }else if(E0 > 0.2){
    reply = "Processing with emotional continuity.";
  }else{
    reply = llmEnabled
      ? "Fallback to offline LLM response."
      : "Stored locally. Limited resonance.";
  }

  addMsg(reply,"bot");
}

/* =========================
   CONTROLS
========================= */
function toggleLLM(){
  llmEnabled=!llmEnabled;
  addMsg("LLM "+(llmEnabled?"enabled":"disabled"),"bot");
}
function clearTM(){
  TM.length=0;
  addMsg("Temporary memory cleared.","bot");
}
function showBM(){
  addMsg(
    BM.map(b=>`${b.locked?"ðŸ”’ ":""}${b.text} (${b.count})`).join(" | ") || "BM empty",
    "bot"
  );
}

/* INIT */
maintainBM();
</script>
</body>
</html>