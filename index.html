<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Offline Emotional Continuity Prototype (4.9 tuned)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#020817;
      --card:#020617;
      --card-soft:#050b1f;
      --pill:#0ea5e9;
      --pill2:#22c55e;
      --accent:#0ea5e9;
      --accent-soft:rgba(14,165,233,0.18);
      --border:rgba(148,163,184,0.35);
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;
      --good:#22c55e;
      --bad:#f97316;
      --danger:#f97373;
      --faith:#facc15;
    }
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#0f172a 0,#020617 45%,#000 100%);
      color:var(--text-main);
      min-height:100vh;
      padding:18px 8px 32px;
    }
    .shell{
      max-width:980px;
      margin:0 auto;
      background:radial-gradient(circle at top,#0b1220,#020617 52%,#000);
      border-radius:32px;
      padding:18px 12px 28px;
      box-shadow:0 32px 80px rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.4);
      position:relative;
      overflow:hidden;
    }
    .shell::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 10% 0,rgba(56,189,248,0.15),transparent 50%),
                 radial-gradient(circle at 90% 10%,rgba(34,197,94,0.12),transparent 55%);
      opacity:.8;
      pointer-events:none;
    }
    .shell-inner{position:relative;z-index:1}

    .hero{
      border-radius:28px;
      padding:18px 12px 18px;
      background:radial-gradient(circle at top,#020617,#020617 55%,#000 100%);
      border:1px solid rgba(148,163,184,0.4);
      box-shadow:0 20px 40px rgba(15,23,42,0.9);
      margin-bottom:14px;
    }
    .hero-title{
      text-align:center;
      font-size:1.6rem;
      letter-spacing:.2em;
      font-weight:650;
      color:#7dd3fc;
      text-shadow:0 0 20px rgba(56,189,248,0.55);
    }
    .hero-sub{
      margin-top:6px;
      text-align:center;
      font-size:.82rem;
      color:var(--text-soft);
      line-height:1.5;
    }

    .ethic-card{
      margin-top:14px;
      border-radius:24px;
      padding:14px 16px 14px 16px;
      background:radial-gradient(circle at 0 0,#1f2937,#020617 55%);
      border:1px solid rgba(148,163,184,0.5);
      position:relative;
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    .ethic-dot{
      width:14px;height:14px;border-radius:999px;
      border:2px solid rgba(251,191,36,0.9);
      box-shadow:0 0 10px rgba(251,191,36,0.7);
      background:radial-gradient(circle,var(--faith),#f97316);
      position:absolute;
      right:14px;top:14px;
      cursor:pointer;
    }
    .ethic-title{
      font-size:.7rem;
      letter-spacing:.3em;
      color:rgba(248,250,252,0.7);
      text-transform:uppercase;
      margin-bottom:4px;
    }
    .ethic-text{
      font-size:.86rem;
      line-height:1.5;
      color:#fefce8;
    }
    .ethic-meta{
      margin-top:4px;
      font-size:.7rem;
      color:rgba(248,250,252,0.8);
      opacity:.85;
    }

    .engine-pill{
      margin-top:14px;
      border-radius:999px;
      padding:10px 18px;
      background:linear-gradient(90deg,rgba(56,189,248,0.95),rgba(45,212,191,0.96),rgba(34,197,94,0.96));
      color:#0f172a;
      font-weight:600;
      text-align:center;
      font-size:.9rem;
      letter-spacing:.08em;
      text-transform:uppercase;
      box-shadow:0 18px 40px rgba(34,197,94,0.55);
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
    }
    .engine-pill span.status-dot{
      width:10px;height:10px;border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 12px rgba(34,197,94,0.9);
    }

    .mainRow{
      margin-top:16px;
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    .col{
      flex:1;
      min-width:0;
    }
    .card{
      background:radial-gradient(circle at top left,#020617,#020617 55%,#000);
      border-radius:24px;
      padding:14px 12px 14px;
      border:1px solid rgba(148,163,184,0.6);
      box-shadow:0 18px 35px rgba(15,23,42,0.9);
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .card-title{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:.9rem;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:#7dd3fc;
    }
    .card-title-icon{
      width:26px;height:26px;border-radius:999px;
      background:radial-gradient(circle,#0ea5e9,#22c55e);
      display:flex;align-items:center;justify-content:center;
      color:#0f172a;font-size:1.1rem;
      box-shadow:0 0 16px rgba(56,189,248,0.7);
    }
    .pill-mini{
      font-size:.7rem;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.7);
      color:var(--text-soft);
    }

    .console-label{
      font-size:.75rem;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--text-soft);
      margin-top:4px;
      margin-bottom:4px;
    }
    .console{
      margin-top:4px;
      height:190px;          /* ‚Üì ÿ™⁄æŸà⁄ëÿß ⁄©ŸÖ ⁄©€åÿß ÿ™ÿß⁄©€Å chat ŸÜ€å⁄Ü€í ŸÜÿ∏ÿ± ÿ¢ÿ¶€í */
      border-radius:18px;
      background:#020617;
      border:1px solid rgba(30,64,175,0.9);
      padding:8px 10px;
      font-size:.75rem;
      line-height:1.4;
      color:var(--text-soft);
      overflow-y:auto;
      box-shadow:inset 0 0 16px rgba(15,23,42,0.9);
    }

    .historyBox{
      margin-top:8px;
      max-height:120px;
      overflow-y:auto;
      font-size:.72rem;
    }
    .historyLine{
      display:flex;
      justify-content:space-between;
      gap:6px;
      padding:4px 0;
      border-bottom:1px dashed rgba(51,65,85,0.6);
    }
    .historyText{color:var(--text-soft)}
    .historyLock{
      border:none;
      background:transparent;
      cursor:pointer;
    }

    .chatWrap{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .conversationBox{
      border-radius:18px;
      border:1px solid rgba(30,64,175,0.9);
      background:#020617;
      padding:8px 10px;
      min-height:130px;
      max-height:220px;
      overflow-y:auto;
      font-size:.78rem;
      box-shadow:inset 0 0 18px rgba(15,23,42,0.95);
    }
    .msg{
      margin-bottom:6px;
      padding:7px 9px;
      border-radius:12px;
      max-width:92%;
      line-height:1.4;
      word-wrap:break-word;
    }
    .msg.user{
      background:rgba(56,189,248,0.12);
      border:1px solid rgba(56,189,248,0.7);
      align-self:flex-end;
    }
    .msg.aura{
      background:rgba(34,197,94,0.12);
      border:1px solid rgba(34,197,94,0.7);
      align-self:flex-start;
    }

    /* Faith bubble ‚Äì SAME EFFECT, ÿµÿ±ŸÅ ŸæŸàÿ≤€åÿ¥ŸÜ ÿßŸàŸæÿ± ⁄©€å */
    .faithBubble{
      margin-top:4px;
      border-radius:40px;
      background:radial-gradient(circle,#facc15,#f97316);
      color:#1f2933;
      padding:7px 14px 7px 34px;
      font-size:.78rem;
      position:relative;
      box-shadow:0 12px 25px rgba(234,179,8,0.55);
      display:none;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .faithBubble.show{display:flex;}
    .faithBubble.flying{
      animation:riseAndDock 0.9s ease-out forwards;
      transform-origin:center;
    }
    @keyframes riseAndDock{
      0%{transform:translateY(28px) scale(.96);opacity:0;}
      45%{transform:translateY(-4px) scale(1.02);opacity:1;}
      100%{transform:translateY(0) scale(1);opacity:1;}
    }
    .faithBubble-icon{
      position:absolute;
      left:12px;top:7px;
      font-size:1rem;
    }
    .faithBubble-close{
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:.9rem;
      opacity:.8;
    }

    .reactionBar{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:2px;
      font-size:.8rem;
      color:var(--text-soft);
    }
    .reactionBtn{
      width:30px;height:30px;
      border-radius:999px;
      border:none;
      background:rgba(15,23,42,0.85);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 0 0 1px rgba(148,163,184,0.5);
    }
    .reactionBtn:hover{box-shadow:0 0 0 1px rgba(56,189,248,0.8)}
    .reactionHint{font-size:.72rem;color:var(--text-soft)}

    .liveCapsule{
      margin-top:4px;
      font-size:.74rem;
      border-radius:999px;
      padding:5px 10px;
      background:radial-gradient(circle at left,#020617,#020617 55%,#000);
      border:1px solid rgba(30,64,175,0.9);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .liveCapsule span.label{color:var(--text-soft);font-size:.72rem}
    .liveMetrics{display:flex;gap:12px;font-family:monospace;font-size:.72rem}
    .liveMetric-good{color:var(--good)}
    .liveMetric-neutral{color:#e5e7eb}
    .liveMetric-cont{color:#38bdf8}

    .inputRow{
      margin-top:4px;
      display:flex;
      gap:8px;
      align-items:flex-end;
    }
    .inputRow textarea{
      flex:1;
      resize:none;
      border-radius:18px;
      border:1px solid rgba(51,65,85,0.9);
      background:#020617;
      padding:8px 10px;
      min-height:40px;
      max-height:80px;
      font-size:.8rem;
      color:var(--text-main);
    }
    .sendBtn{
      border-radius:999px;
      border:none;
      padding:0 18px;
      height:40px;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#0f172a;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 14px 28px rgba(34,197,94,0.65);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      font-size:.8rem;
    }

    .baseline{
      margin-top:8px;
      font-size:.72rem;
      color:var(--text-soft);
      font-family:monospace;
      text-align:center;
    }

    .subCard{
      margin-top:14px;
      border-radius:22px;
      padding:10px 12px 12px;
      background:radial-gradient(circle at top,#020617,#020617 55%,#000);
      border:1px solid rgba(148,163,184,0.55);
      box-shadow:0 18px 35px rgba(15,23,42,0.9);
    }
    .subTitle{
      font-size:.78rem;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--text-soft);
      margin-bottom:4px;
    }
    .subRow{
      display:flex;
      justify-content:space-between;
      font-size:.75rem;
      color:var(--text-soft);
    }
    .engineStatus-pill{
      padding:3px 10px;
      border-radius:999px;
      border:1px solid rgba(34,197,94,0.8);
      color:var(--good);
      font-size:.72rem;
    }

    /* ethic / faith settings small modal */
    .chipRow{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .chip{
      border-radius:999px;
      padding:4px 10px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);
      font-size:.72rem;
      color:var(--text-soft);
      cursor:pointer;
    }
    .chip.active{
      background:var(--accent-soft);
      color:#e0f2fe;
      border-color:rgba(56,189,248,0.9);
      box-shadow:0 0 0 1px rgba(56,189,248,0.9);
    }
    .faithGoalText{
      margin-top:4px;
      font-size:.7rem;
      color:var(--text-soft);
      display:flex;
      justify-content:space-between;
    }

    /* mobile tweaks */
    @media (max-width:760px){
      .shell{padding:14px 10px 22px;border-radius:26px}
      .hero-title{font-size:1.35rem}
      .mainRow{flex-direction:column}
      .console{height:165px;}  /* ŸÖÿ≤€åÿØ ⁄©ŸÖ */
      .conversationBox{min-height:120px;max-height:210px}
    }
    @media (max-width:420px){
      body{padding:10px 4px 18px}
      .shell{padding:12px 8px 18px}
      .console{height:150px;}
      .conversationBox{max-height:190px}
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="shell-inner">
    <section class="hero">
      <div class="hero-title">AURA-X Œ©</div>
      <div class="hero-sub">
        Offline emotional continuity engine (prototype). TM = user inputs only ¬∑
        Internal layers keep continuity and emotional trajectory.
      </div>

      <div class="ethic-card" id="ethicCard">
        <div>
          <div class="ethic-title">UNIVERSAL ETHIC</div>
          <div class="ethic-text" id="ethicText">
            Avoid actions that grow negative emotions in you or others. Move gently
            toward choices that increase shared positive feeling for everyone.
          </div>
          <div class="ethic-meta" id="ethicMeta">
            Mode: universal ¬∑ Faith lens overlays tone only.
          </div>
        </div>
        <button class="ethic-dot" id="ethicToggle" title="Toggle universal / faith-adapted ethic"></button>
      </div>

      <div class="engine-pill">
        <span class="status-dot"></span>
        EMOTIONAL CONTINUITY ENGINE ‚Äî ACTIVE
      </div>
    </section>

    <section class="mainRow">
      <!-- LEFT: options / console -->
      <div class="col">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <div class="card-title-icon">‚öôÔ∏è</div>
              <span>Options ¬∑ engine behavior & continuity</span>
            </div>
            <div class="pill-mini" id="continuityModeLabel">Continuity focus: emotional resonance</div>
          </div>

          <div class="console-label">TM & BM stream ¬∑ conversation, resonance & continuity</div>
          <div class="console" id="consoleBox">
            <div>Prototype console. TM/BM feed, emotional reactor updates and internal notes will appear here.</div>
          </div>

          <div class="console-label" style="margin-top:8px;">Recent continuity history (48h, locked entries persist)</div>
          <div class="historyBox" id="historyBox"></div>
        </div>
      </div>

      <!-- RIGHT: conversation -->
      <div class="col">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <div class="card-title-icon">üí¨</div>
              <span>TM stream ¬∑ conversation & feelings</span>
            </div>
            <div class="pill-mini" id="biasLabel">Bias / skew: balanced ‚öñÔ∏è</div>
          </div>

          <div class="chatWrap">
            <div class="conversationBox" id="conversationBox"></div>

            <!-- Faith bubble ÿßÿ® ÿßŸàŸæÿ± ÿ±⁄©⁄æÿß ⁄Ø€åÿß €Å€í ÿ™ÿß⁄©€Å chat hide ŸÜ€Å €ÅŸà -->
            <div class="faithBubble" id="faithBubble">
              <span class="faithBubble-icon">üí≠</span>
              <span id="faithBubbleText">
                Faith lens: Islam ¬∑ You'll get updates according to your selected faith above.
              </span>
              <button class="faithBubble-close" id="faithBubbleClose" title="Hide this">‚úï</button>
            </div>

            <div class="reactionBar" id="reactionBar">
              <button class="reactionBtn" data-reaction="up" title="This felt good üëç">üëç</button>
              <button class="reactionBtn" data-reaction="down" title="This felt heavy üëé">üëé</button>
              <button class="reactionBtn" data-reaction="voice" title="Toggle voice answer üîä">üîä</button>
              <button class="reactionBtn" data-reaction="link" title="Continuity link üîó">üîó</button>
              <button class="reactionBtn" data-reaction="identity" title="User identity üßë‚Äçüíª">üë•</button>
              <span class="reactionHint">Reactions adjust emotional continuity (E‚ÇÄ) only ‚Äî no external APIs.</span>
            </div>

            <div class="liveCapsule">
              <span class="label">Emotional reactor snapshot</span>
              <div class="liveMetrics">
                <span id="eMetric" class="liveMetric-good">E‚ÇÄ: 0.000</span>
                <span id="tmMetric" class="liveMetric-neutral">TM: 0.00</span>
                <span id="bmMetric" class="liveMetric-neutral">BM: 0.00</span>
                <span id="cMetric" class="liveMetric-cont">C: 0.850</span>
              </div>
            </div>

            <div class="inputRow">
              <textarea id="userInput" placeholder="Talk to AURA-X Œ©‚Ä¶ (TM = your inputs only)"></textarea>
              <button class="sendBtn" id="sendBtn">
                SEND
              </button>
            </div>

            <div class="baseline">
              E‚ÇÄ = tanh( R(TM,BM) + I(TM) + I_intel + I_LLM ‚àí D + Œª_faith + Œª_sys + Œª_trc )
            </div>
          </div>
        </div>

        <div class="subCard">
          <div class="subTitle">BM overview (meaningful, repeated patterns)</div>
          <div class="subRow">
            <span>Stored BM snapshots: <span id="bmCount">0</span></span>
            <span class="engineStatus-pill" id="engineStatus">Engine status: active</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Faith chips / settings (inline, not modal for now) -->
    <section class="subCard" style="margin-top:16px;">
      <div class="subTitle">Faith lens (optional)</div>
      <div class="chipRow" id="faithChips"></div>
      <div class="faithGoalText">
        <span>üïäÔ∏è Goal: kindness, not debate.</span>
        <span id="faithLensLabel">Faith lens: Islam</span>
      </div>
    </section>

  </div>
</div>

<script>
  const FAITH_OPTIONS = [
    { id:"islam", label:"Islam" },
    { id:"christianity", label:"Christianity" },
    { id:"buddhism", label:"Buddhism" },
    { id:"hinduism", label:"Hinduism" },
    { id:"judaism", label:"Judaism" },
    { id:"sikhism", label:"Sikhism" },
    { id:"atheist", label:"Atheist / Humanist" },
    { id:"other", label:"Other / Custom" },
    { id:"none", label:"None" }
  ];

  const els = {
    ethicText: document.getElementById("ethicText"),
    ethicMeta: document.getElementById("ethicMeta"),
    ethicToggle: document.getElementById("ethicToggle"),
    consoleBox: document.getElementById("consoleBox"),
    historyBox: document.getElementById("historyBox"),
    conversationBox: document.getElementById("conversationBox"),
    userInput: document.getElementById("userInput"),
    sendBtn: document.getElementById("sendBtn"),
    eMetric: document.getElementById("eMetric"),
    tmMetric: document.getElementById("tmMetric"),
    bmMetric: document.getElementById("bmMetric"),
    cMetric: document.getElementById("cMetric"),
    bmCount: document.getElementById("bmCount"),
    engineStatus: document.getElementById("engineStatus"),
    biasLabel: document.getElementById("biasLabel"),
    faithChips: document.getElementById("faithChips"),
    faithLensLabel: document.getElementById("faithLensLabel"),
    faithBubble: document.getElementById("faithBubble"),
    faithBubbleText: document.getElementById("faithBubbleText"),
    faithBubbleClose: document.getElementById("faithBubbleClose"),
    reactionBar: document.getElementById("reactionBar")
  };

  const state = {
    history: [],
    tmScore: 0,
    bmScore: 0,
    e0: 0,
    continuity: 0.85,
    bmSnapshots: 0,
    universalEthic:true,
    faithSelection:["islam"],
    faithBubbleSeen:false
  };

  function addHistory(role,text){
    const item = {role,text,ts:Date.now()};
    state.history.push(item);
    if(state.history.length>80) state.history.shift();
    renderHistory();
  }

  function renderHistory(){
    els.historyBox.innerHTML = "";
    state.history.forEach(h=>{
      const row = document.createElement("div");
      row.className = "historyLine";
      const dt = new Date(h.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});
      const left = document.createElement("div");
      left.className = "historyText";
      left.textContent = `[${dt}] ${h.role}: ${h.text}`;
      const lock = document.createElement("button");
      lock.className = "historyLock";
      lock.textContent = "üîí";
      row.appendChild(left);
      row.appendChild(lock);
      els.historyBox.appendChild(row);
    });
  }

  function appendMsg(role,text){
    const div = document.createElement("div");
    div.className = "msg " + (role==="user"?"user":"aura");
    div.textContent = text;
    els.conversationBox.appendChild(div);
    els.conversationBox.scrollTop = els.conversationBox.scrollHeight;
    addHistory(role,text);
  }

  function updateMetrics(deltaTM){
    state.tmScore = Math.max(-1,Math.min(1,state.tmScore + deltaTM));
    state.e0 = Math.max(-1,Math.min(1,state.e0 + deltaTM * 0.6));
    els.tmMetric.textContent = "TM: " + state.tmScore.toFixed(2);
    els.eMetric.textContent = "E‚ÇÄ: " + state.e0.toFixed(3);
    const color = state.e0>=0 ? "liveMetric-good" : "liveMetric-neutral";
    els.eMetric.className = color;
  }

  function sendUser(){
    const text = els.userInput.value.trim();
    if(!text) return;
    els.userInput.value = "";
    appendMsg("user",text);
    updateMetrics(0.05);
    const reply = buildAuraReply(text);
    setTimeout(()=>appendMsg("aura",reply),250);
  }

  function buildAuraReply(text){
    const base =
      "[Faith lens: Islam] I want to help you keep this trajectory kind and balanced. " +
      "In an Islamic spirit I‚Äôll respond with mercy and ihsan, without judging or attacking anyone. ";

    return base + "You said: ‚Äú" + text + "‚Äù. I‚Äôll keep tracking TM ‚Üí BM without storing any IDs.";
  }

  function renderFaithChips(){
    els.faithChips.innerHTML = "";
    FAITH_OPTIONS.forEach(opt=>{
      const chip = document.createElement("button");
      const active = state.faithSelection.includes(opt.id);
      chip.className = "chip" + (active ? " active":"");
      chip.textContent = opt.label;
      chip.addEventListener("click",()=>{
        if(opt.id==="none"){
          state.faithSelection = [];
        }else{
          state.faithSelection = [opt.id];
        }
        updateFaithLensLabel();
        renderFaithChips();
        triggerFaithBubble();
      });
      els.faithChips.appendChild(chip);
    });
  }

  function currentFaithLabel(){
    if(!state.faithSelection.length) return "None";
    const id = state.faithSelection[0];
    const found = FAITH_OPTIONS.find(o=>o.id===id);
    return found ? found.label : "Custom";
  }

  function updateFaithLensLabel(){
    const label = currentFaithLabel();
    els.faithLensLabel.textContent = "Faith lens: " + label;
  }

  function triggerFaithBubble(){
    if(!els.faithBubble) return;
    const label = currentFaithLabel();
    if(label==="None"){
      els.faithBubble.style.display = "none";
      return;
    }
    els.faithBubbleText.textContent =
      "Faith lens: " + label + " ¬∑ You'll get updates according to your selected faith above.";
    els.faithBubble.classList.add("show","flying");
    // remove flying flag after animation
    setTimeout(()=>els.faithBubble.classList.remove("flying"),900);
  }

  function initFaithBubble(){
    triggerFaithBubble();
    els.faithBubbleClose.addEventListener("click",()=>{
      els.faithBubble.style.display = "none";
    });
  }

  function initReactions(){
    els.reactionBar.querySelectorAll(".reactionBtn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const kind = btn.dataset.reaction;
        if(kind==="up") updateMetrics(0.03);
        else if(kind==="down") updateMetrics(-0.04);
        else if(kind==="voice") addHistory("system","(voice toggle pressed ‚Äì placeholder)");
        else if(kind==="link") addHistory("system","(continuity link tapped ‚Äì placeholder)");
        else if(kind==="identity") addHistory("system","(user identity window open ‚Äì placeholder)");
      });
    });
  }

  function initEthicToggle(){
    els.ethicToggle.addEventListener("click",()=>{
      state.universalEthic = !state.universalEthic;
      if(state.universalEthic){
        els.ethicText.textContent =
          "Avoid actions that grow negative emotions in you or others. Move gently toward choices that increase shared positive feeling for everyone.";
        els.ethicMeta.textContent = "Mode: universal ¬∑ Faith lens overlays tone only.";
      }else{
        const label = currentFaithLabel();
        els.ethicText.textContent =
          "Ethic tilted toward " + label +
          " compassion: protect dignity, avoid zulm (harm / oppression) and keep ihsan (excellence) in how you speak and act.";
        els.ethicMeta.textContent = "Mode: faith-adapted ¬∑ Still no debate, only kindness.";
      }
    });
  }

  function init(){
    renderFaithChips();
    updateFaithLensLabel();
    initFaithBubble();
    initReactions();
    initEthicToggle();
    els.sendBtn.addEventListener("click",sendUser);
    els.userInput.addEventListener("keydown",e=>{
      if(e.key==="Enter" && !e.shiftKey){
        e.preventDefault();
        sendUser();
      }
    });
    // seed welcome
    appendMsg("aura",
      "[System] Emotional continuity engine is active. Talk freely ‚Äî only your text (TM) is stored locally; no IDs or external APIs.");
  }

  init();
</script>
</body>
</html>