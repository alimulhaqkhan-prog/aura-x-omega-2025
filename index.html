<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Ω — Emotional Continuity Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f4ecd8;
      color: #222;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .page {
      width: 100%;
      max-width: 700px;
      background: #fdf7e9;
      border-radius: 18px;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.08);
      padding: 18px 16px 24px;
    }

    header {
      text-align: center;
      margin-bottom: 16px;
    }

    header h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
    }

    header h2 {
      font-size: 0.9rem;
      font-weight: 500;
      color: #555;
    }

    .top-bar {
      display: flex;
      gap: 8px;
      margin-top: 14px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .chip-button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: #e6dac0;
      color: #333;
      font-size: 0.85rem;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    .chip-button.primary {
      background: #0b9150;
      color: white;
    }

    .chip-button:active {
      transform: translateY(1px);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .panel {
      background: white;
      border-radius: 14px;
      padding: 12px 14px;
      margin-top: 14px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
      font-size: 0.9rem;
    }

    .panel-title {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }

    .equation {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
      background: #f3efe4;
      padding: 8px;
      border-radius: 8px;
      margin-top: 4px;
    }

    textarea {
      width: 100%;
      min-height: 90px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid #d9caa6;
      padding: 10px 12px;
      font-size: 0.95rem;
      background: #fffdf7;
    }

    textarea:focus {
      outline: none;
      border-color: #0b9150;
      box-shadow: 0 0 0 1px rgba(11, 145, 80, 0.3);
    }

    .send-row {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }

    .send-btn {
      width: 100%;
      max-width: 320px;
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      background: #0b9150;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.18);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .send-btn:active {
      transform: translateY(1px);
      box-shadow: 0 3px 7px rgba(0, 0, 0, 0.18);
    }

    .send-btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .reply-text {
      white-space: pre-wrap;
      line-height: 1.4;
      font-size: 0.92rem;
    }

    .bm-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .bm-chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #ddd0ac;
      font-size: 0.8rem;
      background: #fffaf1;
    }

    .polarity-line {
      margin-top: 10px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .polarity-bar {
      position: relative;
      flex: 1;
      height: 8px;
      border-radius: 999px;
      background: #f2d2cf;
      overflow: hidden;
    }

    .polarity-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: #9fd9a7;
      width: 50%;
    }

    .polarity-labels {
      font-size: 0.78rem;
    }

    footer {
      margin-top: 16px;
      text-align: center;
      font-size: 0.7rem;
      color: #77715e;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>AURA-X Ω — Emotional Continuity</h1>
      <h2>TM × BM · AEC · CRM · AECN · LR³</h2>

      <div class="top-bar">
        <button id="modeBtn" class="chip-button primary">
          Mode: LOCAL
        </button>
        <button id="faithBtn" class="chip-button">
          Faith Lens: OFF
        </button>
        <button id="voiceBtn" class="chip-button">
          Voice: OFF
        </button>
      </div>
    </header>

    <section class="panel">
      <div class="panel-title">Emotional Continuity Equation</div>
      <div class="equation">
        E₀ = tanh(TM × BM − D + λ_faith + λ_sys + ΣCₜ)
      </div>
      <p style="margin-top:6px;font-size:0.82rem;">
        All parameters are updated after every message to keep emotional continuity live.
      </p>
    </section>

    <section class="panel" style="margin-top:16px;">
      <textarea id="userInput" placeholder="Write anything… AURA-X Ω will treat it as TM (Temporary Memory)."></textarea>
      <div class="send-row">
        <button id="sendBtn" class="send-btn">Send</button>
      </div>
    </section>

    <section class="panel" style="margin-top:12px;">
      <div class="panel-title">AURA-X Ω Reaction</div>
      <div id="replyBox" class="reply-text">
        Local MODE: Feelings processed as TM×BM continuity.<br />
        Your message will appear here.
      </div>
    </section>

    <section class="panel">
      <div class="panel-title">Bold Memory Layers (L1–L7)</div>
      <div class="bm-chips">
        <div class="bm-chip">L1</div>
        <div class="bm-chip">L2</div>
        <div class="bm-chip">L3</div>
        <div class="bm-chip">L4</div>
        <div class="bm-chip">L5</div>
        <div class="bm-chip">L6</div>
        <div class="bm-chip">L7</div>
      </div>

      <div class="polarity-line">
        <span>Polarity:</span>
        <div class="polarity-bar">
          <div id="polarityFill" class="polarity-fill"></div>
        </div>
        <span class="polarity-labels" id="polarityLabel">
          Positive 70 : 30
        </span>
      </div>
    </section>

    <footer>
      Prototype · TM → Analysis → Equation → BM save → Reaction.
    </footer>
  </div>

  <script>
    // ===== CONFIG =====
    const BACKEND_URL = "https://aura-x-omega-backend-1.onrender.com"; // Render backend
    const MODE_LOCAL = "LOCAL";
    const MODE_LIVE = "LIVE";

    let currentMode = MODE_LOCAL;
    let faithOn = false;
    let voiceOn = false;

    const modeBtn = document.getElementById("modeBtn");
    const faithBtn = document.getElementById("faithBtn");
    const voiceBtn = document.getElementById("voiceBtn");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const replyBox = document.getElementById("replyBox");
    const polarityFill = document.getElementById("polarityFill");
    const polarityLabel = document.getElementById("polarityLabel");

    // ===== SIMPLE LOCAL EMOTIONAL ENGINE =====
    function localEmotionScore(text) {
      const t = text.toLowerCase();
      let score = 0;

      const positiveWords = ["love", "happy", "peace", "calm", "hope", "shukr", "thanks", "grateful", "beautiful"];
      const negativeWords = ["fear", "angry", "hate", "sad", "hurt", "anxious", "lonely", "tired", "confused"];

      for (const w of positiveWords) {
        if (t.includes(w)) score += 1;
      }
      for (const w of negativeWords) {
        if (t.includes(w)) score -= 1;
      }

      // Clamp between -3 and +3
      if (score > 3) score = 3;
      if (score < -3) score = -3;

      return score;
    }

    function localReplyFor(text) {
      const score = localEmotionScore(text);
      let polarityText;
      let reaction;

      if (score > 0) {
        polarityText = "Positive 70 : 30";
        reaction =
          "AURA-X Ω (local): I sense a gentle positive drift in your TM.\n" +
          "I honour this feeling and save it as a warm BM trace.\n\n" +
          "Short reflection on your message:\n" + text;
      } else if (score < 0) {
        polarityText = "Negative 40 : 60";
        reaction =
          "AURA-X Ω (local): I feel some heaviness in your TM.\n" +
          "I will hold this carefully as BM and try to stabilise your emotional continuity.\n\n" +
          "Short reflection on your message:\n" + text;
      } else {
        polarityText = "Neutral 50 : 50";
        reaction =
          "AURA-X Ω (local): Your TM feels balanced, without strong positive or negative pull.\n" +
          "I will store this as a gentle, neutral BM layer.\n\n" +
          "Short reflection on your message:\n" + text;
      }

      updatePolarityBar(polarityText);
      return reaction;
    }

    function updatePolarityBar(labelText) {
      polarityLabel.textContent = labelText;

      let positivePercent = 50;
      if (labelText.includes("70")) positivePercent = 70;
      else if (labelText.includes("40")) positivePercent = 40;
      else if (labelText.includes("50")) positivePercent = 50;

      polarityFill.style.width = positivePercent + "%";
    }

    // ===== MODE BUTTONS =====
    modeBtn.addEventListener("click", () => {
      currentMode = currentMode === MODE_LOCAL ? MODE_LIVE : MODE_LOCAL;
      modeBtn.textContent = "Mode: " + currentMode;

      if (currentMode === MODE_LIVE) {
        modeBtn.classList.add("primary");
        replyBox.textContent =
          "LIVE MODE: Feelings processed with TM×BM continuity + Live LLM backend.\n" +
          "Write something and I will call the Render backend.";
      } else {
        modeBtn.classList.remove("primary");
        replyBox.textContent =
          "Local MODE: Feelings processed as TM×BM continuity.\n" +
          "Your message will appear here.";
      }
    });

    faithBtn.addEventListener("click", () => {
      faithOn = !faithOn;
      faithBtn.textContent = "Faith Lens: " + (faithOn ? "ON" : "OFF");
    });

    voiceBtn.addEventListener("click", () => {
      voiceOn = !voiceOn;
      voiceBtn.textContent = "Voice: " + (voiceOn ? "ON" : "OFF");
      // Future: here we can integrate Web Speech / TTS
    });

    // ===== SEND HANDLER =====
    async function handleSend() {
      const text = userInput.value.trim();
      if (!text) return;

      sendBtn.disabled = true;

      if (currentMode === MODE_LOCAL) {
        const reaction = localReplyFor(text);
        replyBox.textContent =
          "Local MODE: Feelings processed as TM×BM continuity.\n\n" +
          "Your message was:\n" + text + "\n\n" + reaction;
        sendBtn.disabled = false;
        return;
      }

      // LIVE MODE: call backend
      try {
        replyBox.textContent = "Contacting AURA-X Ω backend… please wait.";

        const response = await fetch(BACKEND_URL + "/api/react", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ message: text })
        });

        const data = await response.json();

        if (data.ok && data.reply) {
          updatePolarityBar("Positive 58 : 42"); // demo value, later connect to real E₀
          replyBox.textContent =
            "AURA-X Ω (LIVE · gpt-4o-mini):\n\n" + data.reply;
        } else {
          const fallback = localReplyFor(text);
          replyBox.textContent =
            "AURA-X Ω backend error, using local seed-only emotional reply.\n\n" +
            "(Error: " + (data.error || "unknown") + ")\n\n" +
            fallback;
        }
      } catch (err) {
        const fallback = localReplyFor(text);
        replyBox.textContent =
          "Network / CORS error while calling backend, using local seed-only emotional reply.\n\n" +
          "(Error: " + err.message + ")\n\n" +
          fallback;
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) {
        handleSend();
      }
    });

    // Initial polarity
    updatePolarityBar("Positive 70 : 30");
  </script>
</body>
</html>
