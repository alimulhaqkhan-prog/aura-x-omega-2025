<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Ω – Emotional Continuity Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: #fdf4e3;  /* Book-page */
      color: #111827;
      padding: 12px;
    }
    .header {
      text-align: center;
      margin-bottom: 12px;
      font-size: 22px;
      font-weight: bold;
    }
    .top-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .btn-small {
      padding: 10px 16px;
      border-radius: 20px;
      background: #fff;
      border: 1px solid #ddd;
      cursor: pointer;
      font-size: 14px;
    }
    .advice-box, .equation-box, .reaction-box {
      margin: 14px 0;
      padding: 14px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid #ddd;
    }
    .reaction-box {
      background: #e6fff0;
      border: 1px solid #91e6b9;
    }
    #chat-area {
      margin-top: 10px;
      min-height: 200px;
      padding: 8px;
      background: #fff;
      border-radius: 10px;
      border: 1px solid #ddd;
      white-space: pre-wrap;
    }
    .input-area {
      margin-top: 14px;
      display: flex;
      gap: 10px;
    }
    #tmInput {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #bbb;
      font-size: 15px;
    }
    #sendBtn {
      background: #16a34a;
      border: none;
      color: white;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="header">AURA-X Ω – Emotional Continuity</div>

<div class="top-buttons">
  <button class="btn-small" onclick="openBM()">BM Viewer</button>
  <button class="btn-small" onclick="recallBM()">Recall BM</button>
  <button class="btn-small" onclick="recycle48()">Recycle 48h</button>
  <button class="btn-small" onclick="openOptions()">Options</button>
</div>

<div class="advice-box">
  Avoid actions that generate negative emotions. Move gently toward kindness,
  clarity, and positive internal stability.
</div>

<div class="equation-box">
  <b>EMOTIONAL CONTINUITY EQUATION</b><br><br>
  E₀ = tanh(TM × BM − D + λ_faith + λ_sys + ΣCₜ)
</div>

<div id="reaction" class="reaction-box">
  AURA-X Ω is waiting for your input…
</div>

<div id="chat-area"></div>

<div class="input-area">
  <input id="tmInput" placeholder="Write anything… AURA-X Ω treats it as TM (Temporary Memory)." />
  <button id="sendBtn" onclick="sendTM()">Send</button>
</div>

<script>
/* ================================
   CONFIG
================================ */
const BACKEND_URL = "https://aura-x-omega-backend.onrender.com/api/react";

/* ================================
   LOCAL STORAGE – BM / TM SYSTEM
================================ */
function saveBM(obj) {
  localStorage.setItem("AURAX_BM", JSON.stringify(obj));
}
function loadBM() {
  return JSON.parse(localStorage.getItem("AURAX_BM") || "{}");
}

/* ================================
   BUTTON FUNCTIONS
================================ */
function openBM() {
  const data = loadBM();
  alert("Bold Memory (BM):\n\n" + JSON.stringify(data, null, 2));
}

function recallBM() {
  const data = loadBM();
  document.getElementById("reaction").innerHTML =
    "<b>Recall BM:</b><br>" + JSON.stringify(data, null, 2);
}

function recycle48() {
  localStorage.removeItem("AURAX_BM");
  alert("48h recycling complete. BM cleared.");
}

function openOptions() {
  alert("LLM Engine is active. Backend URL:\n" + BACKEND_URL);
}

/* ================================
   MAIN MESSAGE FLOW
================================ */
async function sendTM() {
  const tm = document.getElementById("tmInput").value.trim();
  if (!tm) return;

  appendChat("You: " + tm);

  let bm = loadBM();

  try {
    const res = await fetch(BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        tm: tm,
        state: {
          bm: bm,
          llmModel: "gpt-4.1"
        }
      })
    });

    if (!res.ok) throw new Error("HTTP " + res.status);

    const data = await res.json();

    // Save BM returned by backend
    if (data?.bm) saveBM(data.bm);

    updateReaction(data);
    appendChat("AURA-X Ω: " + data.reply);

  } catch (err) {
    updateReaction({
      reply: "Backend error, but your TM/BM remain saved locally.",
      polarity: "Mixed",
      tone: "Fallback"
    });

    appendChat("AURA-X Ω (local fallback): " + tm);
  }

  document.getElementById("tmInput").value = "";
}

/* ================================
   UI UPDATE
================================ */
function updateReaction(d) {
  document.getElementById("reaction").innerHTML =
    `<b>AURA-X Ω REACTION</b><br>
     Polarity: ${d.polarity || "Mixed"}<br>
     Tone: ${d.tone || "Neutral"}<br><br>
     ${d.reply}`;
}

function appendChat(msg) {
  const box = document.getElementById("chat-area");
  box.innerHTML += msg + "\n\n";
  box.scrollTop = box.scrollHeight;
}
</script>

</body>
</html>
