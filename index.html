<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Offline Emotional Continuity Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Offline LLM (WebLLM ‚Äì browser side, future-ready) -->
  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";
    window.webllm = webllm;
  </script>

  <style>
    /* =========================
       RESET & GLOBALS
    ========================== */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-main: #0f172a;
      --bg-panel: rgba(255,255,255,0.08);
      --bg-panel-strong: rgba(255,255,255,0.12);
      --text-main: #e5e7eb;
      --text-soft: #cbd5f5;
      --accent: #38bdf8;
      --accent-2: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;
      --gold: #facc15;
      --radius: 14px;
      --blur: blur(14px);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 20% 0%, #1e293b 0, transparent 45%),
        radial-gradient(circle at 80% 0%, #020617 0, transparent 40%),
        var(--bg-main);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }

    /* =========================
       MAIN APP WRAPPER
    ========================== */
    .app {
      width: 100%;
      max-width: 520px;
      height: 100vh;
      max-height: 900px;
      display: flex;
      flex-direction: column;
      background: rgba(15,23,42,0.75);
      backdrop-filter: var(--blur);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 25px 80px rgba(0,0,0,0.45);
    }

    /* =========================
       HEADER
    ========================== */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), transparent);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    .logo .orb {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, #fff, #38bdf8 30%, #1e40af 60%, #020617 100%);
      box-shadow: 0 0 18px rgba(56,189,248,0.6);
    }

    .logo span {
      font-size: 16px;
    }

    .header-buttons {
      display: flex;
      gap: 10px;
    }

    .icon-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: var(--bg-panel);
      color: var(--text-main);
      cursor: pointer;
      display: grid;
      place-items: center;
      font-size: 16px;
    }

    .icon-btn:hover {
      background: var(--bg-panel-strong);
    }

    /* =========================
       STATUS BAR (E, TM, BM)
    ========================== */
    .status-bar {
      display: flex;
      justify-content: space-around;
      gap: 6px;
      padding: 8px 10px;
      font-size: 12px;
      background: rgba(0,0,0,0.25);
    }

    .status-pill {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.1);
      color: var(--text-soft);
    }

    /* =========================
       CHAT AREA
    ========================== */
    .chat {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .msg {
      max-width: 85%;
      padding: 10px 12px;
      border-radius: var(--radius);
      line-height: 1.4;
      font-size: 14px;
      animation: fadeIn 0.25s ease-out;
    }

    .msg.user {
      align-self: flex-end;
      background: linear-gradient(135deg, #2563eb, #38bdf8);
      color: #fff;
      border-bottom-right-radius: 4px;
    }

    .msg.ai {
      align-self: flex-start;
      background: var(--bg-panel);
      border-bottom-left-radius: 4px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* =========================
       INPUT AREA
    ========================== */
    .input-area {
      display: flex;
      gap: 8px;
      padding: 10px;
      background: linear-gradient(0deg, rgba(255,255,255,0.06), transparent);
    }

    .input-area input {
      flex: 1;
      padding: 10px 12px;
      border-radius: var(--radius);
      border: none;
      background: rgba(255,255,255,0.12);
      color: var(--text-main);
      outline: none;
    }

    .send-btn {
      padding: 0 16px;
      border-radius: var(--radius);
      border: none;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      font-weight: 600;
      cursor: pointer;
    }

    /* =========================
       MODALS
    ========================== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .modal.active {
      display: flex;
    }

    .modal-box {
      width: 92%;
      max-width: 420px;
      background: rgba(15,23,42,0.95);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 30px 90px rgba(0,0,0,0.6);
    }

    .modal-box h3 {
      margin-bottom: 10px;
      font-size: 16px;
    }

    .modal-box p {
      font-size: 13px;
      line-height: 1.5;
      color: var(--text-soft);
    }

    .modal-box button {
      margin-top: 14px;
      padding: 8px 12px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #022c22;
      cursor: pointer;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- HEADER -->
    <div class="header">
      <div class="logo">
        <div class="orb"></div>
        <span>AURA-X Œ©</span>
      </div>
      <div class="header-buttons">
        <button class="icon-btn" onclick="openModal('modalAbout')">‚ÑπÔ∏è</button>
        <button class="icon-btn" onclick="openModal('modalFaith')">üßø</button>
        <button class="icon-btn" onclick="toggleOptions()">‚ò∞</button>
      </div>
    </div>

    <!-- STATUS -->
    <div class="status-bar">
      <div class="status-pill">E: <span id="valE">0.00</span></div>
      <div class="status-pill">TM: <span id="valTM">0</span></div>
      <div class="status-pill">BM: <span id="valBM">0</span></div>
      <div class="status-pill">R: <span id="valR">0.00</span></div>
    </div>

    <!-- CHAT -->
    <div class="chat" id="chat"></div>

    <!-- INPUT -->
    <div class="input-area">
      <input id="userInput" placeholder="Type your message‚Ä¶" />
      <button class="send-btn" onclick="sendMsg()">Send</button>
    </div>

  </div>

  <!-- ABOUT MODAL -->
  <div class="modal" id="modalAbout">
    <div class="modal-box">
      <h3>About AURA-X Œ©</h3>
      <p>
        AURA-X Œ© is an offline-first emotional continuity prototype.
        It models conversation as resonance between Temporary Memory (TM)
        and Bold Memory (BM), with decay, faith coefficient, and system logic.
      </p>
      <button onclick="closeModal('modalAbout')">Close</button>
    </div>
  </div>

  <!-- FAITH MODAL -->
  <div class="modal" id="modalFaith">
    <div class="modal-box">
      <h3>Faith Window</h3>
      <p>
        Faith here is not religion-specific. It is a stabilizing coefficient
        that prevents emotional collapse under decay and noise.
      </p>
      <button onclick="closeModal('modalFaith')">Close</button>
    </div>
  </div>

  <script>
    /* =========================
       MEMORY & STATE
    ========================== */
    let TM = [];
    let BM = JSON.parse(localStorage.getItem("BM") || "[]");
    let E = 0;
    let R = 0;

    const decay = 0.02;
    const lambdaFaith = 0.4;

    /* =========================
       UI HELPERS
    ========================== */
    function openModal(id){ document.getElementById(id).classList.add("active"); }
    function closeModal(id){ document.getElementById(id).classList.remove("active"); }
    function toggleOptions(){ alert("Options panel placeholder"); }

    function addMsg(text, cls){
      const d = document.createElement("div");
      d.className = "msg " + cls;
      d.textContent = text;
      chat.appendChild(d);
      chat.scrollTop = chat.scrollHeight;
    }

    function updateStatus(){
      document.getElementById("valTM").textContent = TM.length;
      document.getElementById("valBM").textContent = BM.length;
      document.getElementById("valE").textContent = E.toFixed(2);
      document.getElementById("valR").textContent = R.toFixed(2);
    }

    /* =========================
       CORE LOGIC
    ========================== */
    function computeResonance(){
      const tmVal = TM.length;
      const bmVal = BM.length;
      R = Math.tanh((tmVal * bmVal) - decay + lambdaFaith);
      E = R;
      updateStatus();
    }

    function aiReply(userText){
      // 1) BM exact match
      const found = BM.find(x => x.q === userText);
      if(found){
        addMsg(found.a, "ai");
        computeResonance();
        return;
      }

      // 2) Simple seed logic
      if(userText.toLowerCase().includes("who created you")){
        const ans = "I am AURA-X Œ©, created by Alim ul Haq from Pakistan.";
        addMsg(ans, "ai");
        BM.push({q:userText, a:ans});
        localStorage.setItem("BM", JSON.stringify(BM));
        computeResonance();
        return;
      }

      // 3) Fallback
      addMsg("I am thinking‚Ä¶ (offline reasoning)", "ai");
      computeResonance();
    }

    function sendMsg(){
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if(!text) return;
      input.value = "";
      addMsg(text, "user");
      TM.push(text);
      aiReply(text);
    }

    // Restore status on load
    updateStatus();
  </script>
</body>
</html>