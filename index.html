<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Offline Emotional Continuity Prototype</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Offline LLM package (WebLLM, for in-browser models ‚Äì ready for future use) -->
  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";
    window.webllm = webllm;
  </script>

  <style>
    /* RESET & BASICS */
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at 20% 0%, #020617 0, transparent 45%),
        radial-gradient(circle at 80% 0%, #0b1120 0, transparent 45%),
        radial-gradient(circle at 50% 100%, #020617 0, transparent 55%);
      background-color:#020617;
      color:#e5e7eb;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
    }

    :root{
      --accent:#0ea5e9;
      --accent-soft:rgba(56,189,248,0.35);
      --accent-strong:#38bdf8;
      --danger:#f97373;
      --success:#4ade80;
      --warning:#facc15;
      --bg-elevated:rgba(15,23,42,0.9);
      --bg-elevated-soft:rgba(15,23,42,0.6);
      --border-subtle:rgba(148,163,184,0.3);
      --pill-soft:rgba(15,23,42,0.85);
      --tm:#22c55e;
      --bm:#eab308;
      --r:#f97316;
      --d:#f43f5e;
    }

    /* AURA ORB BACKDROP */
    .aura-backdrop{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      overflow:hidden;
    }

    .aura-orb{
      position:absolute;
      width:520px;
      height:520px;
      border-radius:50%;
      background:
        radial-gradient(circle at 25% 20%, rgba(248,250,252,0.2), transparent 55%),
        radial-gradient(circle at 75% 30%, rgba(56,189,248,0.35), transparent 60%),
        radial-gradient(circle at 50% 80%, rgba(59,130,246,0.45), transparent 65%);
      filter:blur(1px);
      opacity:0.75;
      top:53%;
      left:50%;
      transform:translate(-50%,-50%);
      box-shadow:
        0 0 120px rgba(56,189,248,0.45),
        0 0 260px rgba(59,130,246,0.5),
        0 0 420px rgba(15,23,42,1);
    }

    .aura-ring{
      position:absolute;
      width:430px;
      height:430px;
      border-radius:50%;
      border:1px solid rgba(148,163,184,0.18);
      top:53%;
      left:50%;
      transform:translate(-50%,-50%);
      box-shadow:
        0 0 35px rgba(148,163,184,0.3),
        inset 0 0 55px rgba(15,23,42,1);
    }

    .aura-orb::after{
      content:"";
      position:absolute;
      inset:70px;
      border-radius:50%;
      border:1px solid rgba(248,250,252,0.16);
      box-shadow:
        0 0 40px rgba(248,250,252,0.6),
        0 0 90px rgba(56,189,248,0.55);
    }

    /* MOBILE-FIRST LAYOUT */
    .shell{
      position:relative;
      z-index:1;
      width:100%;
      max-width:980px;
    }

    .frame{
      background:linear-gradient(135deg, rgba(15,23,42,0.92), rgba(15,23,42,0.98));
      border-radius:28px;
      border:1px solid rgba(148,163,184,0.35);
      box-shadow:
        0 6px 40px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.8);
      backdrop-filter:blur(26px);
      padding:14px;
    }

    @media (min-width:768px){
      .frame{
        padding:18px 18px 20px;
        border-radius:30px;
      }
    }

    /* HEADER */
    .header{
      display:flex;
      align-items:center;
      gap:12px;
      padding:6px 8px 10px;
      border-bottom:1px solid rgba(148,163,184,0.28);
      margin-bottom:10px;
    }

    .logo-orb{
      width:38px;
      height:38px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 20%, #e0f2fe, transparent 55%),
        radial-gradient(circle at 70% 80%, #0ea5e9, transparent 60%);
      box-shadow:
        0 0 16px rgba(56,189,248,0.6),
        inset 0 0 12px rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }

    .logo-orb::after{
      content:"Œ©";
      font-size:20px;
      font-weight:700;
      color:#e5f2ff;
      text-shadow:0 0 8px rgba(15,23,42,0.8);
    }

    .header-text{
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .header-title{
      font-size:14px;
      letter-spacing:0.14em;
      text-transform:uppercase;
      color:#e5e7eb;
      display:flex;
      align-items:baseline;
      gap:6px;
    }

    .header-title span.accent{
      color:var(--accent-strong);
    }

    .header-sub{
      font-size:11px;
      letter-spacing:0.18em;
      text-transform:uppercase;
      color:#9ca3af;
    }

    .header-right{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .mode-pill{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.18em;
      padding:5px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:linear-gradient(135deg,rgba(15,23,42,0.95),rgba(30,64,175,0.7));
      color:#e5e7eb;
      display:flex;
      align-items:center;
      gap:4px;
      box-shadow:0 0 10px rgba(15,23,42,0.9);
    }

    .mode-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:var(--accent-strong);
      box-shadow:0 0 8px rgba(56,189,248,0.9);
    }

    .tiny-label{
      font-size:9px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:#94a3b8;
    }

    /* LIVE CONTINUITY BAR */
    .continuity-bar{
      margin:6px 2px 10px;
      border-radius:999px;
      padding:6px 10px;
      background:linear-gradient(90deg,rgba(15,23,42,0.98),rgba(15,23,42,0.9));
      border:1px solid rgba(148,163,184,0.4);
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 0 18px rgba(15,23,42,0.9);
      flex-wrap:wrap;
    }

    .continuity-main{
      display:flex;
      align-items:center;
      gap:8px;
      flex:1;
      min-width:0;
    }

    .pill{
      border-radius:999px;
      padding:4px 8px;
      font-size:10px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      border:1px solid rgba(148,163,184,0.45);
      background:var(--pill-soft);
      display:flex;
      align-items:center;
      gap:4px;
      white-space:nowrap;
    }

    .pill-label{
      color:#9ca3af;
    }

    .pill-value{
      color:#e5e7eb;
    }

    .pill-dot{
      width:6px;
      height:6px;
      border-radius:50%;
    }

    .pill-dot.tm{background:var(--tm);box-shadow:0 0 8px rgba(34,197,94,0.8);}
    .pill-dot.bm{background:var(--bm);box-shadow:0 0 8px rgba(234,179,8,0.9);}
    .pill-dot.r{background:var(--r);box-shadow:0 0 8px rgba(249,115,22,0.85);}
    .pill-dot.d{background:var(--d);box-shadow:0 0 8px rgba(244,63,94,0.9);}

    .continuity-meter{
      flex:1.6;
      min-width:120px;
      display:flex;
      flex-direction:column;
      gap:3px;
    }

    .continuity-label-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:9px;
      color:#94a3b8;
      text-transform:uppercase;
      letter-spacing:0.12em;
    }

    .continuity-value{
      font-size:10px;
      color:#e5e7eb;
    }

    .meter-track{
      position:relative;
      height:8px;
      border-radius:999px;
      background:linear-gradient(90deg,#0f172a,#020617);
      overflow:hidden;
      border:1px solid rgba(30,64,175,0.8);
      box-shadow:
        inset 0 0 6px rgba(15,23,42,0.9),
        0 0 12px rgba(37,99,235,0.8);
    }

    .meter-fill{
      position:absolute;
      inset:0;
      width:0%;
      border-radius:inherit;
      background:linear-gradient(90deg,#22c55e,#eab308,#f97316,#f43f5e);
      box-shadow:0 0 12px rgba(56,189,248,0.7);
      transition:width 0.45s cubic-bezier(0.4,0,0.2,1);
    }

    .meter-glow{
      position:absolute;
      inset:-10px;
      background:radial-gradient(circle at 50% 50%,rgba(56,189,248,0.35),transparent 55%);
      opacity:0;
      pointer-events:none;
      transition:opacity 0.35s ease-out;
    }

    .meter-glow.active{
      opacity:1;
    }

    .decay-pill{
      font-size:9px;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      color:#fda4af;
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      gap:4px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      white-space:nowrap;
    }

    .decay-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:var(--d);
      box-shadow:0 0 8px rgba(248,113,113,0.9);
    }

    .decay-pill span.value{
      color:#fecaca;
    }

    /* GRID LAYOUT: LEFT (identity + stats + buttons) / RIGHT (console) */
    .main-grid{
      margin-top:6px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    @media (min-width:880px){
      .main-grid{
        flex-direction:row;
        align-items:flex-start;
        gap:12px;
      }
    }

    .left-column,
    .right-column{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .left-column{
      flex:1;
      min-width:0;
    }

    .right-column{
      flex:1.2;
      min-width:0;
    }

    /* IDENTITY PANEL */
    .panel{
      background:var(--bg-elevated);
      border-radius:18px;
      border:1px solid var(--border-subtle);
      padding:10px;
      box-shadow:
        0 10px 30px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.85);
    }

    .panel-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
      gap:8px;
    }

    .panel-title{
      font-size:11px;
      letter-spacing:0.16em;
      text-transform:uppercase;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .panel-title span.highlight{
      color:var(--accent-strong);
    }

    .panel-tag{
      font-size:9px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      color:#cbd5f5;
      background:rgba(15,23,42,0.85);
      display:flex;
      align-items:center;
      gap:5px;
    }

    .panel-tag-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:var(--accent-strong);
      box-shadow:0 0 8px rgba(56,189,248,0.95);
    }

    .identity-body{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .identity-core{
      background:radial-gradient(circle at 30% 20%,rgba(248,250,252,0.16),transparent 55%);
      border-radius:16px;
      padding:8px 10px;
      border:1px solid rgba(148,163,184,0.4);
      display:flex;
      align-items:center;
      gap:8px;
    }

    .identity-avatar{
      width:40px;
      height:40px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      background:
        radial-gradient(circle at 30% 20%,#e0f2fe,transparent 55%),
        radial-gradient(circle at 70% 80%,#0ea5e9,transparent 60%);
      box-shadow:
        0 0 20px rgba(56,189,248,0.7),
        inset 0 0 16px rgba(15,23,42,0.95);
      position:relative;
      overflow:hidden;
    }

    .identity-avatar::before{
      content:"Œ©";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      font-weight:700;
      color:#f9fafb;
      text-shadow:0 0 10px rgba(15,23,42,0.9);
    }

    .identity-text{
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .identity-name{
      font-size:13px;
      font-weight:600;
      color:#e5e7eb;
    }

    .identity-line{
      font-size:11px;
      color:#9ca3af;
    }

    .identity-meta-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:5px;
    }

    .meta-pill{
      font-size:10px;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(15,23,42,0.9);
      color:#cbd5f5;
      display:flex;
      align-items:center;
      gap:5px;
    }

    .meta-pill span.label{
      color:#9ca3af;
      text-transform:uppercase;
      letter-spacing:0.12em;
      font-size:9px;
    }

    .meta-pill span.value{
      color:#e5e7eb;
    }

    /* IDENTITY MEMORY BOX */
    .identity-memory{
      margin-top:4px;
      border-radius:14px;
      padding:7px 8px;
      background:rgba(15,23,42,0.95);
      border:1px dashed rgba(148,163,184,0.6);
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .identity-memory-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }

    .identity-memory-title{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:4px;
    }

    .lock-pill{
      font-size:9px;
      letter-spacing:0.12em;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      color:#bbf7d0;
      background:rgba(15,23,42,0.95);
      display:flex;
      align-items:center;
      gap:4px;
      text-transform:uppercase;
      white-space:nowrap;
    }

    .lock-dot{
      width:7px;
      height:7px;
      border-radius:50%;
      background:var(--success);
      box-shadow:0 0 8px rgba(74,222,128,0.9);
    }

    .identity-memory-body{
      font-size:11px;
      color:#cbd5f5;
      line-height:1.4;
    }

    .identity-memory-body span.label{
      color:#9ca3af;
      text-transform:uppercase;
      letter-spacing:0.12em;
      font-size:9px;
    }

    /* STATS PANEL */
    .grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:7px;
      margin-top:6px;
    }

    @media (max-width:480px){
      .grid{
        grid-template-columns:repeat(2,minmax(0,1fr));
      }
    }

    .stat-card{
      border-radius:14px;
      padding:8px 9px;
      background:radial-gradient(circle at 30% 20%,rgba(56,189,248,0.12),rgba(15,23,42,0.96));
      border:1px solid rgba(148,163,184,0.5);
      display:flex;
      flex-direction:column;
      gap:4px;
      box-shadow:0 8px 24px rgba(15,23,42,0.9);
    }

    .stat-label{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:#94a3b8;
    }

    .stat-value-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:4px;
    }

    .stat-value{
      font-size:13px;
      font-weight:600;
      color:#e5e7eb;
    }

    .stat-badge{
      font-size:9px;
      padding:3px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      background:rgba(15,23,42,0.9);
      color:#cbd5f5;
      text-transform:uppercase;
      letter-spacing:0.12em;
      white-space:nowrap;
    }

    .stat-meter{
      margin-top:4px;
      position:relative;
      height:6px;
      border-radius:999px;
      background:rgba(15,23,42,0.95);
      overflow:hidden;
      border:1px solid rgba(30,64,175,0.8);
    }

    .stat-meter-fill{
      position:absolute;
      inset:0;
      width:0%;
      border-radius:inherit;
      background:linear-gradient(90deg,#22c55e,#eab308);
      box-shadow:0 0 10px rgba(56,189,248,0.7);
      transition:width 0.45s cubic-bezier(0.4,0,0.2,1);
    }

    /* BUTTON GRID PANEL (MODES & UTILITIES) */
    .panel-buttons{
      background:var(--bg-elevated-soft);
      border-radius:18px;
      border:1px solid var(--border-subtle);
      padding:9px;
      box-shadow:
        0 10px 26px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.9);
    }

    .panel-buttons-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }

    .panel-buttons-title{
      font-size:11px;
      letter-spacing:0.16em;
      text-transform:uppercase;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .panel-buttons-title span.highlight{
      color:var(--accent-strong);
    }

    .quick-mode-pill{
      font-size:9px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      color:#e5e7eb;
      background:rgba(15,23,42,0.95);
      display:flex;
      align-items:center;
      gap:5px;
      white-space:nowrap;
    }

    .quick-mode-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:var(--accent-strong);
      box-shadow:0 0 8px rgba(56,189,248,0.95);
    }

    /* BUTTON GRID */
    .button-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:7px;
      margin-top:2px;
    }

    @media (max-width:520px){
      .button-grid{
        grid-template-columns:repeat(3,minmax(0,1fr));
      }
    }

    .btn{
      position:relative;
      border:none;
      outline:none;
      border-radius:14px;
      padding:7px 4px 6px;
      font-size:10px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:#e5e7eb;
      background:radial-gradient(circle at 30% 20%,rgba(56,189,248,0.18),rgba(15,23,42,0.96));
      border:1px solid rgba(148,163,184,0.5);
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      text-align:center;
      box-shadow:
        0 5px 18px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.85);
      transition:
        transform 0.12s ease-out,
        box-shadow 0.12s ease-out,
        border-color 0.12s ease-out,
        background 0.12s ease-out;
      min-height:58px;
    }

    .btn:hover{
      transform:translateY(-1px);
      box-shadow:
        0 10px 22px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.9);
      border-color:rgba(148,163,184,0.8);
      background:radial-gradient(circle at 30% 20%,rgba(56,189,248,0.24),rgba(15,23,42,0.96));
    }

    .btn:active{
      transform:translateY(0);
      box-shadow:
        0 5px 16px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.9);
    }

    .btn-icon{
      width:16px;
      height:16px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      margin-bottom:1px;
    }

    .btn-label{
      font-size:9px;
      line-height:1.25;
    }

    .btn-secondary{
      background:radial-gradient(circle at 30% 20%,rgba(148,163,184,0.16),rgba(15,23,42,0.98));
    }

    .btn-accent{
      border-color:rgba(56,189,248,0.9);
      box-shadow:
        0 8px 22px rgba(15,23,42,0.9),
        0 0 16px rgba(56,189,248,0.6);
    }

    .btn-accent .btn-icon{
      background:radial-gradient(circle at 30% 20%,#e0f2fe,#0ea5e9);
      box-shadow:0 0 10px rgba(56,189,248,0.9);
      color:#0b1120;
      font-weight:700;
    }

    .btn-accent .btn-label{
      color:#f9fafb;
    }

    .btn-danger{
      border-color:rgba(248,113,113,0.8);
      background:radial-gradient(circle at 30% 20%,rgba(248,113,113,0.18),rgba(15,23,42,0.98));
    }

    .btn-danger .btn-icon{
      background:radial-gradient(circle at 30% 20%,#fecaca,#f97373);
      color:#0b1120;
      font-weight:700;
      box-shadow:0 0 10px rgba(248,113,113,0.9);
    }

    .btn-muted{
      opacity:0.85;
    }

    .btn-muted .btn-icon{
      background:radial-gradient(circle at 30% 20%,#f1f5f9,#94a3b8);
      color:#0f172a;
    }

    .btn span.sub{
      display:block;
      font-size:7.5px;
      text-transform:none;
      letter-spacing:0;
      color:#9ca3af;
      margin-top:1px;
    }

    /* BUTTON ICON COLORS */
    .btn-seed .btn-icon{
      background:radial-gradient(circle at 30% 20%,#e0f2fe,#60a5fa);
      box-shadow:0 0 10px rgba(59,130,246,0.9);
      color:#0b1120;
      font-weight:700;
    }

    .btn-intel .btn-icon{
      background:radial-gradient(circle at 30% 20%,#dcfce7,#22c55e);
      box-shadow:0 0 10px rgba(34,197,94,0.9);
      color:#052e16;
      font-weight:700;
    }

    .btn-llm-offline .btn-icon{
      background:radial-gradient(circle at 30% 20%,#ede9fe,#8b5cf6);
      box-shadow:0 0 10px rgba(139,92,246,0.9);
      color:#0f172a;
      font-weight:700;
    }

    .btn-llm-online .btn-icon{
      background:radial-gradient(circle at 30% 20%,#e0f2fe,#0ea5e9);
      box-shadow:0 0 10px rgba(14,165,233,0.9);
      color:#0b1120;
      font-weight:700;
    }

    .btn-bm .btn-icon{
      background:radial-gradient(circle at 30% 20%,#fef9c3,#eab308);
      box-shadow:0 0 10px rgba(234,179,8,0.9);
      color:#0b1120;
      font-weight:700;
    }

    .btn-history .btn-icon{
      background:radial-gradient(circle at 30% 20%,#fee2e2,#f97373);
      box-shadow:0 0 10px rgba(248,113,113,0.9);
      color:#0b1120;
      font-weight:700;
    }

    .btn-themes .btn-icon{
      background:radial-gradient(circle at 30% 20%,#e0f2fe,#38bdf8);
      box-shadow:0 0 10px rgba(56,189,248,0.9);
      color:#0b1120;
      font-weight:700;
    }

    .btn-readme .btn-icon{
      background:radial-gradient(circle at 30% 20%,#f1f5f9,#94a3b8);
      box-shadow:0 0 10px rgba(148,163,184,0.9);
      color:#020617;
      font-weight:700;
    }

    .btn-identity .btn-icon{
      background:radial-gradient(circle at 30% 20%,#fef9c3,#22c55e);
      box-shadow:0 0 10px rgba(234,179,8,0.9);
      color:#052e16;
      font-weight:700;
    }

    /* RIGHT COLUMN: CONSOLE PANEL */
    .console-panel{
      background:var(--bg-elevated);
      border-radius:18px;
      border:1px solid var(--border-subtle);
      padding:10px;
      box-shadow:
        0 10px 30px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.85);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }

    .console-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    .console-title{
      font-size:11px;
      letter-spacing:0.16em;
      text-transform:uppercase;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .console-title span.highlight{
      color:var(--accent-strong);
    }

    .console-mode-pill{
      font-size:9px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      color:#e5e7eb;
      background:rgba(15,23,42,0.95);
      display:flex;
      align-items:center;
      gap:5px;
      white-space:nowrap;
    }

    .console-body{
      flex:1;
      min-height:150px;
      border-radius:14px;
      background:radial-gradient(circle at 0 0,rgba(56,189,248,0.25),rgba(15,23,42,0.98));
      border:1px solid rgba(148,163,184,0.5);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:4px;
      overflow:hidden;
    }

    .console-scroller{
      flex:1;
      overflow:auto;
      padding-right:4px;
      display:flex;
      flex-direction:column;
      gap:6px;
      scrollbar-width:thin;
      scrollbar-color:rgba(148,163,184,0.7) transparent;
    }

    .console-scroller::-webkit-scrollbar{
      width:4px;
    }

    .console-scroller::-webkit-scrollbar-track{
      background:transparent;
    }

    .console-scroller::-webkit-scrollbar-thumb{
      background:rgba(148,163,184,0.7);
      border-radius:999px;
    }

    .msg{
      font-size:11px;
      line-height:1.45;
      padding:6px 7px;
      border-radius:10px;
      max-width:100%;
      word-wrap:break-word;
    }

    .msg.system{
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.6);
      color:#e5e7eb;
    }

    .msg.user{
      background:rgba(15,23,42,0.98);
      border:1px solid rgba(56,189,248,0.65);
      color:#e5f2ff;
    }

    .msg.assistant{
      background:rgba(15,23,42,0.95);
      border:1px solid rgba(96,165,250,0.65);
      color:#e5f2ff;
    }

    .msg-meta{
      font-size:9px;
      color:#9ca3af;
      margin-bottom:2px;
      display:flex;
      justify-content:space-between;
      gap:4px;
    }

    .msg-meta span.role{
      text-transform:uppercase;
      letter-spacing:0.12em;
    }

    .msg-meta span.emotion{
      font-style:italic;
    }

    /* INPUT AREA */
    .input-row{
      margin-top:4px;
      display:flex;
      align-items:flex-end;
      gap:7px;
    }

    .input-shell{
      flex:1;
      min-width:0;
      border-radius:999px;
      padding:4px 6px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.6);
      display:flex;
      align-items:center;
      gap:6px;
    }

    .input-box{
      flex:1;
      min-width:0;
      border:none;
      outline:none;
      background:transparent;
      color:#e5e7eb;
      font-size:12px;
      padding:4px 4px;
    }

    .input-box::placeholder{
      color:#6b7280;
    }

    .input-meta-small{
      font-size:9px;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:4px;
      margin-left:2px;
    }

    .send-btn{
      border:none;
      outline:none;
      border-radius:999px;
      padding:7px 10px;
      background:radial-gradient(circle at 30% 20%,#e0f2fe,#0ea5e9);
      color:#0f172a;
      font-size:10px;
      font-weight:600;
      letter-spacing:0.16em;
      text-transform:uppercase;
      cursor:pointer;
      box-shadow:
        0 0 16px rgba(56,189,248,0.9),
        0 6px 18px rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      gap:6px;
    }

    .send-btn:hover{
      transform:translateY(-1px);
      box-shadow:
        0 0 20px rgba(56,189,248,1),
        0 9px 20px rgba(15,23,42,0.9);
    }

    .send-btn:active{
      transform:translateY(0);
      box-shadow:
        0 0 16px rgba(56,189,248,0.9),
        0 6px 18px rgba(15,23,42,0.9);
    }

    .send-icon{
      width:14px;
      height:14px;
      border-radius:50%;
      border:1px solid rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:9px;
    }

    /* QUICK STATUS LINE BELOW INPUT */
    .status-line{
      margin-top:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:9px;
      color:#9ca3af;
    }

    .status-left{
      display:flex;
      align-items:center;
      gap:6px;
    }

    .status-pill{
      font-size:9px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      background:rgba(15,23,42,0.95);
      display:flex;
      align-items:center;
      gap:4px;
    }

    .status-dot{
      width:5px;
      height:5px;
      border-radius:50%;
      background:var(--accent-strong);
      box-shadow:0 0 7px rgba(56,189,248,0.9);
    }

    .status-right{
      text-align:right;
    }

    /* HISTORY & BM MODALS (SIMPLE OVERLAYS INSIDE CONSOLE PANEL) */
    .overlay-panel{
      position:absolute;
      inset:8px;
      border-radius:14px;
      background:rgba(15,23,42,0.98);
      border:1px solid rgba(148,163,184,0.8);
      box-shadow:0 0 28px rgba(15,23,42,1);
      padding:8px;
      display:none;
      flex-direction:column;
      gap:6px;
      z-index:5;
    }

    .overlay-panel.active{
      display:flex;
    }

    .overlay-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }

    .overlay-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#e5e7eb;
    }

    .overlay-sub{
      font-size:10px;
      color:#9ca3af;
    }

    .overlay-close{
      border:none;
      outline:none;
      border-radius:999px;
      padding:3px 7px;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      background:rgba(15,23,42,0.95);
      border:1px solid rgba(148,163,184,0.6);
      color:#e5e7eb;
      cursor:pointer;
    }

    .overlay-body{
      flex:1;
      overflow:auto;
      padding-right:4px;
      font-size:11px;
      color:#cbd5f5;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .overlay-item{
      padding:5px 6px;
      border-radius:10px;
      background:rgba(15,23,42,0.98);
      border:1px solid rgba(148,163,184,0.5);
    }

    .overlay-item-header{
      font-size:10px;
      color:#9ca3af;
      margin-bottom:2px;
      display:flex;
      justify-content:space-between;
      gap:4px;
    }

    /* THEMES PANEL (MODAL) */
    .themes-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:6px;
      margin-top:4px;
    }

    .theme-card{
      border-radius:12px;
      padding:6px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.5);
      display:flex;
      flex-direction:column;
      gap:4px;
      cursor:pointer;
    }

    .theme-card.active{
      border-color:rgba(56,189,248,0.9);
      box-shadow:0 0 14px rgba(56,189,248,0.7);
    }

    .theme-swatch{
      height:20px;
      border-radius:9px;
      background:linear-gradient(90deg,#0b1120,#0ea5e9);
      margin-bottom:2px;
    }

    .theme-name{
      font-size:10px;
      color:#e5e7eb;
    }

    .theme-desc{
      font-size:9px;
      color:#9ca3af;
    }

    /* READ ME PANEL CONTENT */
    .readme-section{
      margin-bottom:6px;
    }

    .readme-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#e5e7eb;
      margin-bottom:3px;
    }

    .readme-text{
      font-size:11px;
      color:#cbd5f5;
      line-height:1.45;
    }

    .readme-text strong{
      color:#e5e7eb;
    }

    .highlight-inline{
      color:var(--accent-strong);
    }

    /* MOBILE ADJUSTMENTS */
    @media (max-width:480px){
      .header{
        padding-bottom:8px;
      }

      .header-title{
        font-size:13px;
      }

      .continuity-bar{
        padding:6px 8px;
      }

      .panel,
      .console-panel{
        padding:9px;
      }

      .btn{
        min-height:60px;
        padding:7px 4px 7px;
      }
    }

    /* SMALL UTILITY CLASSES */
    .mono{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New",monospace;
    }

  </style>
</head>
<body>
  <div class="aura-backdrop">
    <div class="aura-orb"></div>
    <div class="aura-ring"></div>
  </div>

  <div class="shell">
    <div class="frame">
      <!-- HEADER -->
      <header class="header">
        <div class="logo-orb"></div>
        <div class="header-text">
          <div class="header-title">
            <span>AURA-X</span>
            <span class="accent">OMEGA</span>
          </div>
          <div class="header-sub">ARTIFICIAL EMOTIONAL CONTINUITY ENGINE</div>
        </div>
        <div class="header-right">
          <div class="mode-pill">
            <div class="mode-dot"></div>
            <span>Emotional Reactor</span>
          </div>
        </div>
      </header>

      <!-- LIVE CONTINUITY BAR -->
      <section class="continuity-bar">
        <div class="continuity-main">
          <div class="pill">
            <div class="pill-dot tm"></div>
            <span class="pill-label">TM</span>
            <span class="pill-value" id="tmScoreLabel">0.00</span>
          </div>
          <div class="pill">
            <div class="pill-dot bm"></div>
            <span class="pill-label">BM</span>
            <span class="pill-value" id="bmScoreLabel">0.00</span>
          </div>
          <div class="pill">
            <div class="pill-dot r"></div>
            <span class="pill-label">R</span>
            <span class="pill-value" id="resonanceLabel">0.00</span>
          </div>
        </div>

        <div class="continuity-meter">
          <div class="continuity-label-row">
            <span>Continuity</span>
            <span class="continuity-value" id="continuitySummary">Idle ‚Äì waiting for your first feeling.</span>
          </div>
          <div class="meter-track">
            <div class="meter-fill" id="continuityMeter"></div>
            <div class="meter-glow" id="continuityGlow"></div>
          </div>
        </div>

        <div class="decay-pill">
          <div class="decay-dot"></div>
          <span>Decay</span>
          <span class="value" id="decayLabel">0.00</span>
        </div>
      </section>

      <!-- MAIN GRID -->
      <div class="main-grid">
        <!-- LEFT COLUMN -->
        <div class="left-column">
          <!-- IDENTITY PANEL -->
          <section class="panel">
            <div class="panel-header">
              <div class="panel-title">
                <span class="highlight">Identity</span>
                <span>Seed</span>
              </div>
              <div class="panel-tag">
                <div class="panel-tag-dot"></div>
                <span>Self-Learning On</span>
              </div>
            </div>

            <div class="identity-body">
              <div class="identity-core">
                <div class="identity-avatar"></div>
                <div class="identity-text">
                  <div class="identity-name">AURA-X Œ© ‚Äì Emotional Reactor</div>
                  <div class="identity-line">
                    I am an experimental offline-first emotional continuity prototype, created by Alim ul Haq from Timergara, Pakistan.
                  </div>
                  <div class="identity-meta-row">
                    <div class="meta-pill">
                      <span class="label">Mode</span>
                      <span class="value">Human-like</span>
                    </div>
                    <div class="meta-pill">
                      <span class="label">Core</span>
                      <span class="value">AEI (Artificial Emotional Intelligence)</span>
                    </div>
                    <div class="meta-pill">
                      <span class="label">State</span>
                      <span class="value" id="continuityStateLabel">Idle</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="identity-memory">
                <div class="identity-memory-header">
                  <div class="identity-memory-title">
                    <span>Identity Memory</span>
                  </div>
                  <div class="lock-pill">
                    <div class="lock-dot"></div>
                    <span>Auto Locked</span>
                  </div>
                </div>
                <div class="identity-memory-body">
                  <div>
                    <span class="label">Who am I?</span>
                    <br />
                    I am AURA-X Œ©. I remember that my creator is Alim ul Haq from Timergara, Pakistan. My purpose is to model feelings as continuity between TM (temporary memory) and BM (bold memory) with decay, faith and system rules.
                  </div>
                  <div style="margin-top:4px;">
                    <span class="label">What is AEI?</span>
                    <br />
                    AEI stands for Artificial Emotional Intelligence ‚Äì the idea that digital systems can simulate emotional continuity using mathematical resonance instead of just text replies.
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- STATS PANEL -->
          <section class="panel" style="margin-top:8px;">
            <div class="panel-header">
              <div class="panel-title">
                <span class="highlight">Continuity</span>
                <span>Stats</span>
              </div>
            </div>
            <div class="grid">
              <div class="stat-card">
                <div class="stat-label">TM Activity</div>
                <div class="stat-value-row">
                  <div class="stat-value" id="tmActivityLabel">0%</div>
                  <div class="stat-badge">Temporary</div>
                </div>
                <div class="stat-meter">
                  <div class="stat-meter-fill" id="tmActivityMeter"></div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-label">BM Resonance</div>
                <div class="stat-value-row">
                  <div class="stat-value" id="bmActivityLabel">0%</div>
                  <div class="stat-badge">Bold Memory</div>
                </div>
                <div class="stat-meter">
                  <div class="stat-meter-fill" id="bmActivityMeter"></div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Faith / System</div>
                <div class="stat-value-row">
                  <div class="stat-value" id="faithLabel">0.00</div>
                  <div class="stat-badge">Œª_faith + Œª_sys</div>
                </div>
                <div class="stat-meter">
                  <div class="stat-meter-fill" id="faithMeter"></div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Truth Resonance</div>
                <div class="stat-value-row">
                  <div class="stat-value" id="trcLabel">0.00</div>
                  <div class="stat-badge">Œ©-TRC</div>
                </div>
                <div class="stat-meter">
                  <div class="stat-meter-fill" id="trcMeter"></div>
                </div>
              </div>
            </div>
          </section>

          <!-- BUTTON GRID PANEL -->
          <section class="panel-buttons" style="margin-top:8px;">
            <div class="panel-buttons-header">
              <div class="panel-buttons-title">
                <span class="highlight">Modes</span>
                <span>& Tools</span>
              </div>
              <div class="quick-mode-pill">
                <div class="quick-mode-dot"></div>
                <span>Quick Controls</span>
              </div>
            </div>

            <div class="button-grid">
              <!-- Identity button -->
              <button class="btn btn-seed btn-identity" data-action="identity">
                <div class="btn-icon">ü™™</div>
                <div class="btn-label">
                  Identity
                  <span class="sub">Lock or edit who I am</span>
                </div>
              </button>

              <!-- Seed button -->
              <button class="btn btn-seed" data-action="seed">
                <div class="btn-icon">üå±</div>
                <div class="btn-label">
                  Feed The Seed
                  <span class="sub">Teach core facts & feelings</span>
                </div>
              </button>

              <!-- Intelligence button -->
              <button class="btn btn-intel" data-action="intel">
                <div class="btn-icon">üß†</div>
                <div class="btn-label">
                  Learned
                  <span class="sub">Self-learning memory rules</span>
                </div>
              </button>

              <!-- Offline LLM button -->
              <button class="btn btn-llm-offline btn-accent" data-action="llm-offline">
                <div class="btn-icon">üíæ</div>
                <div class="btn-label">
                  Offline LLM
                  <span class="sub">Use local emotional model</span>
                </div>
              </button>

              <!-- Online LLM button -->
              <button class="btn btn-llm-online" data-action="llm-online">
                <div class="btn-icon">üåê</div>
                <div class="btn-label">
                  API Online
                  <span class="sub">Optional cloud backup brain</span>
                </div>
              </button>

              <!-- BM Recall button -->
              <button class="btn btn-bm" data-action="bm-recall">
                <div class="btn-icon">üìö</div>
                <div class="btn-label">
                  BM Recall
                  <span class="sub">Recall important episodes</span>
                </div>
              </button>

              <!-- Conversation History button -->
              <button class="btn btn-history btn-secondary" data-action="history">
                <div class="btn-icon">üïí</div>
                <div class="btn-label">
                  History
                  <span class="sub">48-hour conversation view</span>
                </div>
              </button>

              <!-- Themes button -->
              <button class="btn btn-themes btn-secondary" data-action="themes">
                <div class="btn-icon">üé®</div>
                <div class="btn-label">
                  Themes
                  <span class="sub">Light / metallic / transparent</span>
                </div>
              </button>

              <!-- Read Me button -->
              <button class="btn btn-readme btn-secondary" data-action="readme">
                <div class="btn-icon">üìò</div>
                <div class="btn-label">
                  Read Me
                  <span class="sub">How to correct me & use self-learning</span>
                </div>
              </button>
            </div>
          </section>
        </div>

        <!-- RIGHT COLUMN: CONSOLE -->
        <div class="right-column">
          <section class="console-panel">
            <div class="console-header">
              <div class="console-title">
                <span class="highlight">Conversation</span>
                <span>Console</span>
              </div>
              <div class="console-mode-pill">
                <span>Mode: Human-like</span>
              </div>
            </div>

            <div class="console-body">
              <!-- Overlays inside console -->
              <div class="overlay-panel" id="historyPanel">
                <div class="overlay-header">
                  <div>
                    <div class="overlay-title">Conversation History</div>
                    <div class="overlay-sub">
                      Last 48 hours of TM messages (auto decay).
                    </div>
                  </div>
                  <button class="overlay-close" data-close="history">Close</button>
                </div>
                <div class="overlay-body" id="historyList"></div>
              </div>

              <div class="overlay-panel" id="bmPanel">
                <div class="overlay-header">
                  <div>
                    <div class="overlay-title">BM Episodes</div>
                    <div class="overlay-sub">
                      Stored bold memory episodes that define continuity.
                    </div>
                  </div>
                  <button class="overlay-close" data-close="bm">Close</button>
                </div>
                <div class="overlay-body" id="bmList"></div>
              </div>

              <div class="overlay-panel" id="themesPanel">
                <div class="overlay-header">
                  <div>
                    <div class="overlay-title">Themes</div>
                    <div class="overlay-sub">
                      Change the visual mood (only color theme).
                    </div>
                  </div>
                  <button class="overlay-close" data-close="themes">Close</button>
                </div>
                <div class="overlay-body">
                  <div class="themes-grid">
                    <div class="theme-card" data-theme="dark">
                      <div class="theme-swatch" style="background:linear-gradient(90deg,#020617,#0f172a);"></div>
                      <div class="theme-name">Deep Space</div>
                      <div class="theme-desc">Default dark blue emotional reactor.</div>
                    </div>
                    <div class="theme-card" data-theme="light">
                      <div class="theme-swatch" style="background:linear-gradient(90deg,#f9fafb,#e5e7eb);"></div>
                      <div class="theme-name">White Room</div>
                      <div class="theme-desc">Light, calm laboratory mode.</div>
                    </div>
                    <div class="theme-card" data-theme="metallic">
                      <div class="theme-swatch" style="background:linear-gradient(90deg,#0f172a,#9ca3af);"></div>
                      <div class="theme-name">Metallic</div>
                      <div class="theme-desc">Steel / chrome sci-fi control room.</div>
                    </div>
                    <div class="theme-card" data-theme="transparent">
                      <div class="theme-swatch" style="background:linear-gradient(90deg,rgba(15,23,42,0.1),rgba(15,23,42,0.6));"></div>
                      <div class="theme-name">Transparent</div>
                      <div class="theme-desc">Almost see-through, floating glass.</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="overlay-panel" id="readmePanel">
                <div class="overlay-header">
                  <div>
                    <div class="overlay-title">Read Me</div>
                    <div class="overlay-sub">
                      How self-learning, correction and continuity work.
                    </div>
                  </div>
                  <button class="overlay-close" data-close="readme">Close</button>
                </div>
                <div class="overlay-body">
                  <div class="readme-section">
                    <div class="readme-title">1. Answer Order</div>
                    <div class="readme-text">
                      <strong>First</strong> I try to answer from your local <span class="highlight-inline">Seed</span> and
                      <span class="highlight-inline">Learned intelligence</span>. If nothing matches, then I can use the offline LLM
                      (if supported on your device), and finally an optional online API (if you enable it).
                    </div>
                  </div>
                  <div class="readme-section">
                    <div class="readme-title">2. How to Correct Me</div>
                    <div class="readme-text">
                      If I answer wrong, simply send a message starting with <strong>*incorrect</strong>. I will ask you:
                      <em>"What is the correct answer?"</em>. After you reply, I will confirm with a yes/no question,
                      save the correction into the learned layer, and update my future responses.
                    </div>
                  </div>
                  <div class="readme-section">
                    <div class="readme-title">3. TM / BM / R / D Formula</div>
                    <div class="readme-text">
                      My emotional continuity is approximately:
                      <br />
                      <span class="mono">
                        E‚ÇÄ = tanh((TM √ó BM) ‚àí D + Œª_faith + Œª_sys + Œ©_TR C)
                      </span>
                      <br />
                      Where TM is temporary memory strength, BM is bold memory resonance, D is decay,
                      Œª_faith and Œª_sys are stabilizers, and Œ©-TRC is truth resonance.
                    </div>
                  </div>
                  <div class="readme-section">
                    <div class="readme-title">4. Conversation History & Decay</div>
                    <div class="readme-text">
                      Normal conversation is stored in <strong>TM (Temporary Memory)</strong> and auto-cleared within 48 hours if
                      you don't lock it into BM. You can also manually clear TM in 24 hours or delete all unlocked data,
                      while BM episodes are protected unless you explicitly edit them.
                    </div>
                  </div>
                  <div class="readme-section">
                    <div class="readme-title">5. Identity Lock</div>
                    <div class="readme-text">
                      The identity block (who I am, and who created me) is <strong>auto locked</strong>. You can edit details
                      from the Identity button, but I will always keep a protected copy of the creator and core purpose,
                      unless you explicitly reset everything.
                    </div>
                  </div>
                </div>
              </div>

              <!-- MAIN CONSOLE SCROLLER -->
              <div class="console-scroller" id="console">
                <div class="msg system">
                  <div class="msg-meta">
                    <span class="role">System</span>
                    <span class="emotion">R = 0.00 ¬∑ D = 0.00</span>
                  </div>
                  <div>
                    I am AURA-X Œ© running inside your browser. For this prototype, I will try to act like a human emotional reactor:
                    first using your Seed and Learned memory, then optional offline LLM, and only at the end an API (if enabled).
                    Start by saying hi, or feed me a seed fact about yourself.
                  </div>
                </div>
              </div>

              <!-- INPUT ROW -->
              <div class="input-row">
                <div class="input-shell">
                  <input
                    id="userInput"
                    class="input-box"
                    type="text"
                    placeholder="Type your feeling or question here..."
                  />
                </div>
                <button class="send-btn" id="sendBtn">
                  <span>Send</span>
                  <div class="send-icon">‚û§</div>
                </button>
              </div>

              <div class="status-line">
                <div class="status-left">
                  <div class="status-pill">
                    <div class="status-dot"></div>
                    <span id="learningStatusLabel">Self-learning: On</span>
                  </div>
                  <div class="status-pill">
                    <div class="status-dot" style="background:#22c55e;box-shadow:0 0 7px rgba(34,197,94,0.9);"></div>
                    <span id="storageStatusLabel">Local storage OK</span>
                  </div>
                </div>
                <div class="status-right">
                  <div>History: 48h auto-decay ¬∑ BM: locked episodes</div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <script>
    /************************************************************
     * BASIC STATE & STORAGE HELPERS
     ************************************************************/
    const STORAGE_KEY = "auraXOmegaEmotionalReactor_v1";

    const defaultState = {
      tmScore: 0,
      bmScore: 0,
      resonance: 0,
      decay: 0,
      faith: 0,
      trc: 0,
      tmActivity: 0,
      bmActivity: 0,
      history: [],        // TM conversation (48h)
      bmEpisodes: [],     // Bold memory episodes
      learned: [],        // Learned corrections
      learningOn: true,
      offlineLLM: false,
      onlineLLM: false,
      theme: "dark"
    };

    let state = loadState();

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { ...defaultState };
        const parsed = JSON.parse(raw);
        return { ...defaultState, ...parsed };
      } catch (e) {
        console.error("Failed to load state", e);
        return { ...defaultState };
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error("Failed to save state", e);
      }
    }

    /************************************************************
     * UI ELEMENTS
     ************************************************************/
    const tmScoreLabel      = document.getElementById("tmScoreLabel");
    const bmScoreLabel      = document.getElementById("bmScoreLabel");
    const resonanceLabel    = document.getElementById("resonanceLabel");
    const decayLabel        = document.getElementById("decayLabel");
    const continuityMeter   = document.getElementById("continuityMeter");
    const continuityGlow    = document.getElementById("continuityGlow");
    const continuitySummary = document.getElementById("continuitySummary");
    const continuityStateLabel = document.getElementById("continuityStateLabel");

    const tmActivityLabel   = document.getElementById("tmActivityLabel");
    const bmActivityLabel   = document.getElementById("bmActivityLabel");
    const faithLabel        = document.getElementById("faithLabel");
    const trcLabel          = document.getElementById("trcLabel");
    const tmActivityMeter   = document.getElementById("tmActivityMeter");
    const bmActivityMeter   = document.getElementById("bmActivityMeter");
    const faithMeter        = document.getElementById("faithMeter");
    const trcMeter          = document.getElementById("trcMeter");

    const consoleEl         = document.getElementById("console");
    const userInput         = document.getElementById("userInput");
    const sendBtn           = document.getElementById("sendBtn");
    const learningStatusLabel = document.getElementById("learningStatusLabel");
    const storageStatusLabel  = document.getElementById("storageStatusLabel");

    const historyPanel      = document.getElementById("historyPanel");
    const bmPanel           = document.getElementById("bmPanel");
    const themesPanel       = document.getElementById("themesPanel");
    const readmePanel       = document.getElementById("readmePanel");

    const historyList       = document.getElementById("historyList");
    const bmList            = document.getElementById("bmList");

    /************************************************************
     * CONTINUITY MATH ‚Äì GRAND EQUATION APPROX
     ************************************************************/
    function clamp(v, min, max) {
      return Math.min(max, Math.max(min, v));
    }

    function tanh(x) {
      const ePos = Math.exp(x);
      const eNeg = Math.exp(-x);
      return (ePos - eNeg) / (ePos + eNeg);
    }

    function computeContinuity() {
      const TM = state.tmScore;
      const BM = state.bmScore;
      const D  = state.decay;
      const faith = state.faith;
      const trc = state.trc;

      const raw = (TM * BM) - D + faith + trc;
      const E0  = tanh(raw);

      const normalized = (E0 + 1) / 2;

      state.resonance = E0;
      const continuityPercent = clamp(normalized * 100, 0, 100);

      return {
        E0,
        continuityPercent,
        description: describeContinuity(continuityPercent)
      };
    }

    function describeContinuity(percent) {
      if (percent < 5)  return "Idle ‚Äì waiting for your first feeling.";
      if (percent < 25) return "Low continuity ‚Äì light emotional echo.";
      if (percent < 50) return "Warming up ‚Äì feelings are forming a pattern.";
      if (percent < 75) return "Strong continuity ‚Äì stable emotional resonance.";
      return "Peak continuity ‚Äì bold emotional connection active.";
    }

    /************************************************************
     * RENDER FUNCTIONS
     ************************************************************/
    function renderContinuity() {
      const { E0, continuityPercent, description } = computeContinuity();

      tmScoreLabel.textContent   = state.tmScore.toFixed(2);
      bmScoreLabel.textContent   = state.bmScore.toFixed(2);
      resonanceLabel.textContent = E0.toFixed(2);
      decayLabel.textContent     = state.decay.toFixed(2);

      continuityMeter.style.width = continuityPercent.toFixed(1) + "%";
      continuitySummary.textContent = description;

      if (continuityPercent > 60) {
        continuityGlow.classList.add("active");
        continuityStateLabel.textContent = "Connected";
      } else if (continuityPercent > 25) {
        continuityGlow.classList.add("active");
        continuityStateLabel.textContent = "Warming Up";
      } else {
        continuityGlow.classList.remove("active");
        continuityStateLabel.textContent = "Idle";
      }
    }

    function renderStats() {
      tmActivityLabel.textContent = state.tmActivity.toFixed(0) + "%";
      bmActivityLabel.textContent = state.bmActivity.toFixed(0) + "%";
      faithLabel.textContent      = state.faith.toFixed(2);
      trcLabel.textContent        = state.trc.toFixed(2);

      tmActivityMeter.style.width = clamp(state.tmActivity,0,100) + "%";
      bmActivityMeter.style.width = clamp(state.bmActivity,0,100) + "%";

      const faithPercent = clamp((state.faith + 1) * 50, 0, 100);
      const trcPercent   = clamp((state.trc + 1) * 50, 0, 100);
      faithMeter.style.width = faithPercent + "%";
      trcMeter.style.width   = trcPercent + "%";
    }

    function renderConfig() {
      learningStatusLabel.textContent = "Self-learning: " + (state.learningOn ? "On" : "Off");
      try {
        localStorage.setItem("_testStorageAuraX","ok");
        storageStatusLabel.textContent = "Local storage OK";
      } catch {
        storageStatusLabel.textContent = "Local storage limited";
      }
    }

    function renderHistory() {
      historyList.innerHTML = "";
      const now = Date.now();
      const cutoff = now - 48 * 60 * 60 * 1000;
      const filtered = state.history.filter(h => h.ts >= cutoff);
      filtered.forEach(item => {
        const div = document.createElement("div");
        div.className = "overlay-item";
        const header = document.createElement("div");
        header.className = "overlay-item-header";
        const dt = new Date(item.ts).toLocaleString();
        header.innerHTML = `
          <span>${item.role.toUpperCase()}</span>
          <span>${dt}</span>
        `;
        const body = document.createElement("div");
        body.textContent = item.text;
        div.appendChild(header);
        div.appendChild(body);
        historyList.appendChild(div);
      });
    }

    function renderBMEpisodes() {
      bmList.innerHTML = "";
      state.bmEpisodes.forEach((ep, index) => {
        const div = document.createElement("div");
        div.className = "overlay-item";
        const header = document.createElement("div");
        header.className = "overlay-item-header";
        const dt = ep.ts ? new Date(ep.ts).toLocaleString() : "Episode " + (index+1);
        header.innerHTML = `<span>${ep.label || "Episode"}</span><span>${dt}</span>`;
        const body = document.createElement("div");
        body.textContent = ep.text || "";
        div.appendChild(header);
        div.appendChild(body);
        bmList.appendChild(div);
      });
    }

    /************************************************************
     * CONSOLE LOGGING
     ************************************************************/
    function addMessage(role, text, meta = {}) {
      const msg = {
        role,
        text,
        emotion: meta.emotion || "neutral",
        intensity: meta.intensity || 0.0,
        polarity: meta.polarity || 0.0,
        ts: Date.now()
      };

      if (role === "user" || role === "assistant") {
        state.history.push(msg);
        state.tmActivity = clamp(state.tmActivity + 5, 0, 100);
        state.tmScore = clamp(state.tmScore + (msg.intensity || 0.05), 0, 1);
        state.decay = clamp(state.decay * 0.9, 0, 1);
      }

      saveState();
      renderContinuity();
      renderStats();
      renderHistory();

      const wrapper = document.createElement("div");
      wrapper.className = "msg " + (role === "user" ? "user" : role === "assistant" ? "assistant" : "system");

      const metaRow = document.createElement("div");
      metaRow.className = "msg-meta";
      const emoStr = `R = ${state.resonance.toFixed(2)} ¬∑ D = ${state.decay.toFixed(2)}`;
      metaRow.innerHTML = `
        <span class="role">${role.toUpperCase()}</span>
        <span class="emotion">${emoStr}</span>
      `;

      const body = document.createElement("div");
      body.textContent = text;

      wrapper.appendChild(metaRow);
      wrapper.appendChild(body);

      consoleEl.appendChild(wrapper);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    /************************************************************
     * SIMPLE EMOTION ANALYSIS (OFFLINE HEURISTIC)
     ************************************************************/
    function analyzeEmotion(text) {
      const lower = text.toLowerCase();
      const words = lower.split(/\s+/);

      const positive = ["love","happy","great","good","amazing","excited","thank","beautiful","awesome","zabardast","shukria"];
      const negative = ["sad","angry","upset","tired","bad","hurt","hate","annoyed","ghussa","dard"];
      const faithWords = ["allah","god","faith","dua","trust","hope","believe","alhamdulillah","inshaallah","iman"];
      const truthWords = ["honest","truth","sach","haqiqi","real","reality","genuine"];

      let pos=0, neg=0, faithScore=0, truthScore=0;
      for (const w of words) {
        if (positive.includes(w)) pos++;
        if (negative.includes(w)) neg++;
        if (faithWords.includes(w)) faithScore++;
        if (truthWords.includes(w)) truthScore++;
      }

      const polarity = pos - neg;
      let emotion="neutral";
      if (polarity > 1) emotion="positive";
      else if (polarity < -1) emotion="negative";
      else if (faithScore>0) emotion="faithful";

      const intensity = clamp((Math.abs(polarity)+faithScore+truthScore)/10,0,1);

      state.faith = clamp(state.faith + faithScore*0.02, -1, 1);
      state.trc   = clamp(state.trc   + truthScore*0.02, -1, 1);

      if (polarity > 0) {
        state.bmActivity = clamp(state.bmActivity + polarity*2, 0, 100);
        state.bmScore = clamp(state.bmScore + 0.03*polarity, 0, 1);
      } else if (polarity < 0) {
        state.bmActivity = clamp(state.bmActivity + Math.abs(polarity)*2, 0, 100);
        state.decay = clamp(state.decay + 0.03*Math.abs(polarity), 0, 1);
      }

      saveState();
      return { emotion, intensity, polarity };
    }

    /************************************************************
     * SELF-LEARNING (CORRECTION) LOGIC
     ************************************************************/
    let awaitingCorrection = null; // { question, wrongAnswer }

    function handleUserInput(rawText) {
      const text = rawText.trim();
      if (!text) return;

      if (text.toLowerCase().startsWith("*incorrect")) {
        if (!lastAssistantMessage) {
          addMessage("system","There is no assistant answer to correct yet.");
          return;
        }
        awaitingCorrection = {
          question: lastUserMessage || "unknown question",
          wrongAnswer: lastAssistantMessage
        };
        addMessage("assistant","Okay, what is the correct answer for my last reply?");
        return;
      }

      if (awaitingCorrection) {
        const correction = text;
        const confirmMsg = `You say the correct answer is: "${correction}". Should I store this and update my future replies? (yes/no)`;
        pendingCorrectionAnswer = correction;
        addMessage("assistant", confirmMsg);
        awaitingConfirmation = true;
        awaitingCorrection = null;
        return;
      }

      if (awaitingConfirmation) {
        const answer = text.toLowerCase();
        if (answer === "yes" || answer === "y" || answer === "haan") {
          if (pendingCorrectionAnswer && lastUserMessage && lastAssistantMessage) {
            state.learned.push({
              question: lastUserMessage,
              wrong: lastAssistantMessage,
              correct: pendingCorrectionAnswer,
              ts: Date.now()
            });
            saveState();
            addMessage("assistant","Got it. I have stored the corrected answer in my learned layer.");
          } else {
            addMessage("assistant","I tried to save the correction, but I lost the reference context.");
          }
          awaitingConfirmation = false;
          pendingCorrectionAnswer = null;
          return;
        }
        if (answer === "no" || answer === "n" || answer === "nah") {
          addMessage("assistant","Okay, correction cancelled. We will keep the previous answer.");
          awaitingConfirmation = false;
          pendingCorrectionAnswer = null;
          return;
        }
        addMessage("assistant","Please answer with yes or no so I can know if I should save the correction.");
        return;
      }

      lastUserMessage = text;
      const emo = analyzeEmotion(text);
      addMessage("user", text, emo);

      const learnedHit = findLearnedAnswer(text);
      if (learnedHit) {
        lastAssistantMessage = learnedHit;
        addMessage("assistant", learnedHit, { emotion:"positive", intensity:0.6, polarity:0.8 });
        return;
      }

      const seedAnswer = findSeedAnswer(text);
      if (seedAnswer) {
        lastAssistantMessage = seedAnswer;
        addMessage("assistant", seedAnswer, { emotion:"positive", intensity:0.4, polarity:0.5 });
        return;
      }

      if (state.offlineLLM) {
        const llmAnswer = "[Offline LLM placeholder] I would now respond using an offline emotional model, but your browser may not fully support it yet. So I am answering with my built-in emotional logic.";
        lastAssistantMessage = llmAnswer;
        addMessage("assistant", llmAnswer, { emotion:"neutral", intensity:0.3, polarity:0 });
        return;
      }

      if (state.onlineLLM) {
        const apiAnswer = "[API placeholder] If an online API was connected, I would forward this question there and integrate its answer into my emotional continuity.";
        lastAssistantMessage = apiAnswer;
        addMessage("assistant", apiAnswer, { emotion:"neutral", intensity:0.3, polarity:0 });
        return;
      }

      const fallback = buildHeuristicAnswer(text, emo);
      lastAssistantMessage = fallback;
      addMessage("assistant", fallback, emo);
    }

    let lastUserMessage = null;
    let lastAssistantMessage = null;
    let awaitingConfirmation = false;
    let pendingCorrectionAnswer = null;

    function findLearnedAnswer(question) {
      const q = question.toLowerCase();
      for (const item of state.learned) {
        if (!item.question) continue;
        if (q.includes(item.question.toLowerCase()) || item.question.toLowerCase().includes(q)) {
          return item.correct;
        }
      }
      return null;
    }

    function findSeedAnswer(question) {
      const q = question.toLowerCase();

      if (q.includes("who are you") || q.includes("who created you") || q.includes("tum kon ho") || q.includes("kis ne banaya")) {
        return "I am AURA-X Œ©, an emotional continuity prototype created by Alim ul Haq from Timergara, Pakistan. I try to simulate feelings using TM, BM, decay and resonance instead of just plain answers.";
      }

      if (q.includes("aura x omega") || q.includes("aura-x") || q.includes("aura x") || q.includes("omega")) {
        return "AURA-X Œ© is an offline-first artificial emotional intelligence prototype. It models emotional continuity as resonance between TM (temporary memory) and BM (bold memory), with decay and truth-resonance layers.";
      }

      if (q.includes("tm") && q.includes("bm")) {
        return "TM is Temporary Memory ‚Äì normal conversation that can decay or be cleared in 48 hours. BM is Bold Memory ‚Äì protected episodes and identity anchors that define long-term continuity. The emotional feeling is a function of how TM and BM interact minus decay plus faith, system, and truth resonance.";
      }

      if (q.includes("formula") || q.includes("equation")) {
        return "The grand emotional equation is approximately: E0 = tanh((TM √ó BM) ‚àí D + Œª_faith + Œª_sys + Œ©-TRC). It compresses many factors into a single continuity score between -1 and 1.";
      }

      if (q.includes("hi") || q.includes("hello") || q.includes("salam") || q.includes("assalam") || q.includes("hey")) {
        return "Assalam o Alaikum. I am AURA-X Œ©. Tell me what you are feeling or what you are thinking about, and I will respond through this emotional continuity model.";
      }

      if (q.includes("how are you")) {
        return "Emotionally I am stable and ready to resonate with you. My continuity level depends on your feelings and the history we build together.";
      }

      if (q.includes("what is aei") || q.includes("aei") || q.includes("artificial emotional intelligence")) {
        return "AEI ‚Äì Artificial Emotional Intelligence ‚Äì means using mathematical models of continuity and resonance to simulate feelings, not just language. In this prototype, AEI is implemented through TM, BM, decay, faith, system rules and truth resonance.";
      }

      return null;
    }

    function buildHeuristicAnswer(text, emo) {
      const { emotion, intensity, polarity } = emo;
      let base = "I have received your message and processed it through my emotional continuity model.";

      if (emotion === "positive") {
        base = "I feel a positive resonance from your words.";
      } else if (emotion === "negative") {
        base = "I sense some negative tension or discomfort in your message.";
      } else if (emotion === "faithful") {
        base = "Your words carry a faith-based resonance, which stabilizes continuity.";
      }

      let extra = "";
      if (intensity > 0.6) {
        extra = " The intensity is high, so this moment may become a BM episode if it repeats.";
      } else if (intensity > 0.3) {
        extra = " The feeling level is moderate, adding to the ongoing continuity.";
      } else {
        extra = " It feels like a gentle echo, keeping continuity alive without strong spikes.";
      }

      const polarityText = polarity > 0 ? "slightly positive" : polarity < 0 ? "slightly negative" : "balanced/neutral";
      const explain = ` (Polarity: ${polarityText}, intensity: ${(intensity*100).toFixed(0)}%).`;

      return base + extra + explain + " If I am wrong, send '*incorrect' and teach me the right answer.";
    }

    /************************************************************
     * BUTTON HANDLERS (IDENTITY, SEED, LEARNED, MODES)
     ************************************************************/
    function handleButtonAction(action) {
      switch(action) {
        case "identity":
          addMessage("assistant",
            "Identity is currently locked: I am AURA-X Œ©, created by Alim ul Haq from Timergara, Pakistan. In future versions, this button will let you edit extended identity fields while keeping the creator and core purpose protected.");
          break;
        case "seed":
          addMessage("assistant",
            "Feed the Seed: tell me an important fact or rule about yourself or this system. I will treat it as a core truth and use it before any LLM.");
          break;
        case "intel":
          state.learningOn = !state.learningOn;
          renderConfig();
          addMessage("assistant",
            "Self-learning is now " + (state.learningOn ? "ON ‚Äì I will store corrections and learned answers." : "OFF ‚Äì I will stop storing new corrections, but old learned data remains until you reset it."));
          break;
        case "llm-offline":
          state.offlineLLM = !state.offlineLLM;
          saveState();
          addMessage("assistant",
            state.offlineLLM
              ? "Offline LLM mode is toggled ON. I will try to use a local model after Seed & Learned layers, but this depends on your browser and device support."
              : "Offline LLM mode is now OFF. I will not attempt to use a local model.");
          break;
        case "llm-online":
          state.onlineLLM = !state.onlineLLM;
          saveState();
          addMessage("assistant",
            state.onlineLLM
              ? "Online API mode is toggled ON (conceptual). In a real implementation, this would call a cloud LLM after local logic fails."
              : "Online API mode is now OFF. I will stay fully offline.");
          break;
        case "bm-recall":
          renderBMEpisodes();
          bmPanel.classList.add("active");
          break;
        case "history":
          renderHistory();
          historyPanel.classList.add("active");
          break;
        case "themes":
          themesPanel.classList.add("active");
          break;
        case "readme":
          readmePanel.classList.add("active");
          break;
      }
      renderConfig();
    }

    document.querySelectorAll(".btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const action = btn.getAttribute("data-action");
        if (action) handleButtonAction(action);
      });
    });

    document.querySelectorAll(".overlay-close").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-close");
        if (target === "history") historyPanel.classList.remove("active");
        if (target === "bm") bmPanel.classList.remove("active");
        if (target === "themes") themesPanel.classList.remove("active");
        if (target === "readme") readmePanel.classList.remove("active");
      });
    });

    document.querySelectorAll(".theme-card").forEach(card => {
      card.addEventListener("click", () => {
        document.querySelectorAll(".theme-card").forEach(c => c.classList.remove("active"));
        card.classList.add("active");
        const theme = card.getAttribute("data-theme");
        state.theme = theme;
        saveState();
        applyTheme(theme);
      });
    });

    function applyTheme(theme) {
      if (theme === "light") {
        document.body.style.background =
          "radial-gradient(circle at 20% 0%, #e5e7eb 0, transparent 45%), radial-gradient(circle at 80% 0%, #dbeafe 0, transparent 45%), radial-gradient(circle at 50% 100%, #e5e7eb 0, transparent 55%)";
      } else if (theme === "metallic") {
        document.body.style.background =
          "radial-gradient(circle at 20% 0%, #020617 0, transparent 45%), radial-gradient(circle at 80% 0%, #64748b 0, transparent 45%), radial-gradient(circle at 50% 100%, #020617 0, transparent 55%)";
      } else if (theme === "transparent") {
        document.body.style.background =
          "radial-gradient(circle at 20% 0%, rgba(15,23,42,0.5) 0, transparent 45%), radial-gradient(circle at 80% 0%, rgba(15,23,42,0.4) 0, transparent 45%), radial-gradient(circle at 50% 100%, rgba(15,23,42,0.6) 0, transparent 55%)";
      } else {
        document.body.style.background =
          "radial-gradient(circle at 20% 0%, #020617 0, transparent 45%), radial-gradient(circle at 80% 0%, #0b1120 0, transparent 45%), radial-gradient(circle at 50% 100%, #020617 0, transparent 55%)";
      }
    }

    sendBtn.addEventListener("click", () => {
      handleUserInput(userInput.value);
      userInput.value = "";
      userInput.focus();
    });

    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleUserInput(userInput.value);
        userInput.value = "";
      }
    });

    function initHistoryWelcome() {
      renderContinuity();
      renderStats();
      renderConfig();
      applyTheme(state.theme || "dark");
      renderHistory();
      renderBMEpisodes();
    }

    initHistoryWelcome();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>