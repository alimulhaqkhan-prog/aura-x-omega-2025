<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© â€“ Offline Emotional Continuity Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";
    window.webllm = webllm;
  </script>

  <style>
    /* RESET & BASICS */
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: radial-gradient(circle at 20% 0%, #1e293b 0, transparent 45%),
                  radial-gradient(circle at 80% 0%, #0ea5e9 0, transparent 40%),
                  linear-gradient(145deg,#020617 0,#020617 40%,#020617 100%);
      color:#e5e7eb; min-height:100vh; display:flex; justify-content:center; align-items:flex-start; padding:20px;
    }
    .app{ width:100%; max-width:1100px; background:radial-gradient(circle at top,#020617 0,#020617 35%,#020617 100%); border-radius:26px; box-shadow: 0 26px 80px rgba(15,23,42,.85), 0 0 0 1px rgba(148,163,184,.45); padding:18px 20px 12px; display:flex; flex-direction:column; gap:14px; position: relative; overflow:visible; }
    
    /* Header & Controls */
    .header{ position: relative; border-radius: 24px; padding: 16px 18px 14px; display: grid; grid-template-columns: 1.2fr .8fr; gap: 14px; align-items: center; background: radial-gradient(900px 320px at 20% 0%, rgba(56,189,248,.32), rgba(15,23,42,.98) 55%, #020617 100%); border: 1.5px solid rgba(148,163,184,.55); box-shadow: 0 26px 70px rgba(15,23,42,.9), inset 0 1px 0 rgba(255,255,255,.08); z-index:5; }
    .title-block h1{ font-size: 1.7rem; letter-spacing: .10em; text-transform: uppercase; font-weight: 800; line-height: 1.05; }
    .title-block h1 span{ background: linear-gradient(120deg,#38bdf8,#22d3ee,#a5b4fc); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .hero-line{ margin-top: 6px; font-size: .9rem; color: rgba(226,232,240,.96); font-weight: 600; }
    .title-sub{ margin-top: 4px; font-size: .8rem; color: rgba(148,163,184,.98); line-height: 1.35; }
    
    .header-right{ position:relative; z-index:1; display:flex; flex-direction:column; align-items:flex-end; gap:10px; }
    .mode-pill{ width: min(320px, 100%); padding: 14px 16px; border-radius: 999px; border: 1px solid rgba(34,211,238,.6); background: radial-gradient(700px 210px at 20% 20%, rgba(34,211,238,.45), rgba(34,211,238,.18) 45%, rgba(2,6,23,.10) 100%), linear-gradient(135deg, rgba(34,211,238,.45), rgba(6,182,212,.24)); color: rgba(240,253,250,.98); font-size: .88rem; font-weight: 800; letter-spacing: .11em; text-transform: uppercase; text-align: center; box-shadow: 0 18px 50px rgba(34,211,238,.35); position:relative; overflow:hidden; }
    .header-controls{ display:flex; flex-wrap:wrap; justify-content:flex-end; position:relative; margin-top:4px; z-index:20; }
    
    .voice-toggle{ border:none; padding: 6px 12px; border-radius: 999px; font-size: .85rem; background: rgba(248,250,252,.96); color: #0f172a; border: 1px solid rgba(226,232,240,.9); cursor: pointer; display:flex; align-items:center; gap:8px; box-shadow: 0 10px 26px rgba(2,6,23,.6); position: relative; z-index: 21; }
    .voice-toggle:hover{ filter: brightness(1.03); }
    
    .option-panel{ position:absolute; top:115%; right:0; display:none; flex-direction:column; gap:6px; padding:8px; border-radius:16px; background:rgba(15,23,42,.98); border:1px solid rgba(148,163,184,.8); box-shadow:0 20px 46px rgba(15,23,42,.9); z-index:40; min-width:220px; }
    .header-controls.open .option-panel{ display:flex; }
    .small-toggle{ border:none; padding:6px 10px; border-radius:999px; font-size:.78rem; background:#020617; color:#e5e7eb; border:1px solid rgba(148,163,184,.9); cursor:pointer; display:flex; align-items:center; gap:6px; }
    .small-toggle:hover{ background:#020617dd; }

    @media(max-width:900px){ .header{ grid-template-columns:1fr; padding:12px 12px 14px; } .header-right{align-items:stretch} .mode-pill{width:100%} .header-controls{justify-content:flex-start;} }

    /* Layout & Cards */
    .layout{ display:grid; grid-template-columns:minmax(0,1.1fr) minmax(0,1fr); gap:18px; margin-top:4px; margin-bottom: 20px; position:relative; z-index:1; }
    .left-col,.right-col{ display:flex; flex-direction:column; gap:12px; }
    .card{ background:#f9fafb; border-radius:18px; padding:16px 16px 14px; border:1px solid #e5e7eb; box-shadow:0 10px 25px rgba(15,23,42,.45); }
    .card-title{ font-size:.95rem; font-weight:600; color:#0f172a; display:flex; align-items:center; gap:6px; }
    .metrics-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin-top:4px; }
    .metric{ background:#ffffff; border-radius:12px; padding:10px 10px 9px; border:1px solid #e5e7eb; }
    .metric-value{ font-size:1.1rem; font-weight:700; color:#1d4ed8; }
    
    /* BM Canvas */
    .bm-wrapper{ margin-top:8px; }
    .bm-canvas-shell{ background:radial-gradient(circle at top,#e0f2fe 0,#eff6ff 60%,#e2e8f0 100%); border-radius:12px; border:1px solid #dbeafe; height:150px; overflow:hidden; position:relative; cursor:default; }
    #bmCanvas{ width:100%; height:100%; display:block; }
    .bm-footer{ font-size:.72rem; color:#6b7280; margin-top:6px; text-align:center; }

    /* Chat Area */
    .answer-box{ background:#020617; border-radius:12px; padding:10px 10px 12px; border:1px solid #020617; font-family:"Courier New",monospace; color:#e5e7eb; box-shadow:0 16px 40px rgba(15,23,42,.65); max-height:110px; min-height:150px; display:flex; flex-direction:column; gap:6px; }
    .chat-container{ background:transparent; border:none; padding:0; height:auto; max-height:140px; overflow-y:auto; flex-grow: 1; }
    .message{ max-width:100%; padding:6px 7px; margin-bottom:6px; border-radius:8px; font-size:.8rem; line-height:1.5; position:relative; animation:fadeIn .2s ease-out; white-space:pre-wrap; }
    .ai-message{ background:#020617; border-bottom-left-radius:3px; border:1px solid #111827; }
    .user-message{ background:#020617; border-bottom-right-radius:3px; border:1px solid #1f2937; color:#38bdf8; }
    
    /* Input Area */
    .input-footer { margin-top: 4px; padding: 10px 10px 12px; position: sticky; bottom: 0; background: linear-gradient(to bottom, rgba(2,6,23,0), rgba(2,6,23,0.95)); z-index:10; }
    .input-shell { display: flex; align-items: center; width: 100%; max-width: 720px; background: radial-gradient(circle at 0 0, #1f2937 0, #020617 65%); border: 1px solid rgba(148,163,184,.85); border-radius: 999px; padding: 6px 8px 6px 12px; box-shadow: 0 18px 45px rgba(15,23,42,.9); margin:0 auto; }
    .message-input { flex: 1; resize: none; min-height: 26px; max-height: 120px; padding: 6px 6px 6px 0; border: none; outline: none; font-size: .95rem; background: transparent; color: #f9fafb; font-family: inherit; }
    .send-button { border: none; height: 38px; padding: 0 18px; background: linear-gradient(135deg, #2563eb, #06b6d4); color: white; font-weight: 600; font-size: .85rem; cursor: pointer; border-radius: 19px; flex-shrink: 0; margin-left: 6px; }

    /* Modals & New UI */
    .modal-overlay{ position:fixed; inset:0; background:rgba(15,23,42,.55); display:none; align-items:center; justify-content:center; z-index:60; backdrop-filter:blur(6px); }
    .modal-overlay.visible{display:flex;}
    .modal-card{ background:#f9fafb; border-radius:18px; width:min(640px,96vw); max-height:80vh; box-shadow:0 24px 60px rgba(15,23,42,.6); border:1px solid #e5e7eb; display:flex; flex-direction:column; }
    .modal-body{ padding:10px 14px 12px; overflow-y:auto; font-size:.8rem; color:#333; }
    .modal-search{ width:100%; padding:7px 9px; border-radius:10px; border:1px solid #cbd5f5; font-size:.78rem; margin:8px 0 10px; outline:none; background:#ffffff; color:#333; }
    .btn-mini{ font-size:.7rem; padding:4px 8px; border-radius:999px; border:1px solid #dbeafe; background:#eff6ff; cursor:pointer; color:#1d4ed8; }
    
    /* Offline UI */
    .offline-box { border:1px solid #10b981; background:#ecfdf5; padding:10px; border-radius:10px; margin-bottom:10px; }
    .offline-status { font-size:0.7rem; color:#047857; margin-top:5px; font-weight:bold; }
    .btn-offline { background:#10b981 !important; color:white !important; border:none !important; }
    
    @keyframes fadeIn{ from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body>

<div class="app">
  <header class="header">
    <div class="title-block">
      <h1><span>AURA-X Î©</span></h1>
      <div class="hero-line">Worldâ€™s first synthetic emotions engine (prototype)</div>
      <div class="title-sub">TM = user inputs only Â· TM âŸ‚ (BM + Intel + LLM) â†’ Eâ‚€ emotional state</div>
    </div>
    <div class="header-right">
      <div class="mode-pill">EMOTIONAL CONTINUITY ENGINE ACTIVE</div>
      <div class="header-controls" id="headerControls">
        <button id="optionsToggle" class="voice-toggle">âš™ Options</button>
        <div class="option-panel" id="optionPanel">
          <button id="voiceToggle" class="small-toggle">ðŸŽ¤ Voice: OFF</button>
          <button id="intelButton" class="small-toggle">ðŸ§  Intelligence</button>
          <button id="feedSeedButton" class="small-toggle">ðŸŒ± Feed the seed</button>
          <button id="learningToggle" class="small-toggle">ðŸ“š Learning: ON</button>
          <button id="llmSettingsButton" class="small-toggle">ðŸ¤– LLM link</button>
        </div>
      </div>
    </div>
  </header>

  <main class="layout">
    <div class="left-col">
      <section class="card">
        <div class="card-title"><span class="emoji">ðŸ§ª</span> Metrics</div>
        <div class="metrics-grid">
          <div class="metric"><div class="metric-label">Emotional Eâ‚€</div><div id="metricE0" class="metric-value">0.00</div></div>
          <div class="metric"><div class="metric-label">TM Activation</div><div id="metricTM" class="metric-value">0.00</div></div>
        </div>
        <div class="status-row" style="margin-top:10px;">
           <span id="tagValence" class="tag">VALENCE: neutral</span>
           <span id="tagArousal" class="tag">AROUSAL: medium</span>
        </div>
      </section>

      <section class="card">
        <div class="card-title"><span class="emoji">ðŸ§ </span> Bold Memory Layers (240)</div>
        <div class="bm-wrapper">
          <div class="bm-canvas-shell" id="bmShell">
            <canvas id="bmCanvas"></canvas>
          </div>
          <div id="bmStats" class="bm-footer">Active layers: 0/240 Â· System Online</div>
        </div>
      </section>
    </div>

    <div class="right-col">
      <section class="card answer-card">
        <div class="card-title"><span class="emoji">ðŸ’¬</span> Continuity Console</div>
        <div class="answer-shell">
          <div class="answer-box">
            <div id="chatContainer" class="chat-container"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="input-footer">
    <div class="tm-formula-row">
      <div class="tm-formula-pill">Eâ‚€ = tanh((TM Ã— (BM + Intel + LLM)) âˆ’ D + Î»_faith)</div>
    </div>
    <div class="input-row">
      <div class="input-shell">
        <textarea id="messageInput" class="message-input" rows="1" placeholder="Write to AURA-X Î©..."></textarea>
        <button id="sendButton" class="send-button">Send</button>
      </div>
    </div>
  </footer>
</div>

<div id="llmModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">ðŸ¤– LLM Link & Offline Engine</div>
      <button class="modal-close" data-close="llmModal">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="llmLockStage">
        <p class="faith-note">Demo password: <strong>6789</strong></p>
        <input id="llmPasswordInput" type="password" class="modal-search" placeholder="Enter password">
        <button id="llmUnlockBtn" class="btn-mini" style="margin-top:8px;">Unlock</button>
      </div>
      <div id="llmConfigStage" style="display:none;">
        
        <div class="offline-box">
          <p class="faith-note"><strong>OFFLINE MODE:</strong> Run TinyLlama in browser (WebGPU). ~1GB download once.</p>
          <button id="offlineLoadBtn" class="btn-mini btn-offline">ðŸ“¥ Download / Load Model</button>
          <div id="offlineStatus" class="offline-status">Status: Not Loaded</div>
        </div>

        <p class="faith-note" style="margin-top:10px;"><strong>CLOUD API (Optional):</strong></p>
        <label style="font-size:.75rem;">Model Name (e.g. gpt-4o-mini)</label>
        <input id="llmModelInput" class="modal-search" placeholder="Leave empty for auto gpt-4o-mini" />
        
        <label style="font-size:.75rem;">API Base URL</label>
        <input id="llmBaseUrlInput" class="modal-search" value="https://api.openai.com/v1/chat/completions" />

        <label style="font-size:.75rem;">API Key</label>
        <input id="llmKeyInput" type="password" class="modal-search" placeholder="sk-..." />
        
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="llmSaveBtn" class="btn-mini">Save Settings</button>
          <button id="llmClearBtn" class="btn-mini btn-danger">Clear Key</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const STORAGE_KEY = "auraXOmegaState_v9";
  const BM_BANDS = ["Pain","Fear","Love","Identity","Belief","Hope","Wisdom"];
  const BAND_RGB = [[239,68,68],[249,115,22],[34,197,94],[14,165,233],[99,102,241],[234,179,8],[168,85,247]];

  class AuraXOmegaEngine {
    constructor(){
      // --- 1. Load Saved State ---
      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      
      // --- 2. Offline & Voice Init ---
      this.localLLMEngine = null;
      this.offlineLoaded = false;
      this.localModelId = "TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC";
      
      this.voiceOn = false;
      this.recognition = null;
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
        this.recognition = new SpeechRec();
        this.recognition.lang = 'ur-PK'; // Urdu Language
        this.recognition.continuous = false;
        this.recognition.onresult = (e) => {
           this.messageInput.value = e.results[0][0].transcript;
           this.handleSend();
        };
      }

      // --- 3. Core Properties ---
      this.bmLayers = saved.bmLayers || new Array(240).fill(0).map(()=>0.25+Math.random()*0.2);
      this.intelNodes = saved.intelNodes || [];
      this.e0 = saved.e0 || 0.1;
      this.tmHistory = []; // Reset visual history on reload for cleaner view
      
      this.llmEnabled = saved.llmEnabled || false;
      this.llmConfig = saved.llmConfig || { apiKey: "", baseUrl: "https://api.openai.com/v1/chat/completions", model: "" };

      // Seed Rules (Priority 1)
      this.seedRules = [
        { pattern: /who are you/i, reply: "I am AURA-X Î©, your offline emotional continuity engine." },
        { pattern: /hello|hi|salam/i, reply: "Hello. I am listening." },
        { pattern: /nam(e|)?/i, reply: "I am AURA-X Î©." }
      ];

      // --- 4. Boot Up ---
      this.cacheDom();
      this.bindEvents();
      this.resizeCanvas();
      this.startBMAnimation();
      
      this.addMessage("System", "AURA-X Î© initialized. \nHierarchy: Seed -> Intel -> Offline LLM -> Cloud.");
    }

    cacheDom(){
      this.messageInput = document.getElementById("messageInput");
      this.chatContainer = document.getElementById("chatContainer");
      this.sendButton = document.getElementById("sendButton");
      
      // Metrics
      this.metricE0 = document.getElementById("metricE0");
      
      // LLM Modal Elements
      this.llmModal = document.getElementById("llmModal");
      this.llmLockStage = document.getElementById("llmLockStage");
      this.llmConfigStage = document.getElementById("llmConfigStage");
      this.offlineLoadBtn = document.getElementById("offlineLoadBtn");
      this.offlineStatus = document.getElementById("offlineStatus");
      
      this.llmModelInput = document.getElementById("llmModelInput");
      this.llmKeyInput = document.getElementById("llmKeyInput");
      this.llmBaseUrlInput = document.getElementById("llmBaseUrlInput");
      
      // Canvas
      this.bmCanvas = document.getElementById("bmCanvas");
      this.bmCtx = this.bmCanvas.getContext("2d");
      this.bmShell = document.getElementById("bmShell");
    }

    bindEvents(){
      // Chat Events
      this.sendButton.addEventListener("click", () => this.handleSend());
      this.messageInput.addEventListener("keypress", (e) => { if(e.key === "Enter") this.handleSend(); });

      // Menu Toggles
      document.getElementById("optionsToggle").addEventListener("click", (e) => {
         e.stopPropagation();
         document.getElementById("headerControls").classList.toggle("open");
      });
      document.addEventListener("click", (e) => {
         if(!e.target.closest("#headerControls")) document.getElementById("headerControls").classList.remove("open");
      });

      // Voice Toggle
      document.getElementById("voiceToggle").addEventListener("click", (e) => {
         this.voiceOn = !this.voiceOn;
         e.target.textContent = this.voiceOn ? "ðŸŽ¤ Voice: ON" : "ðŸŽ¤ Voice: OFF";
         if(this.voiceOn && this.recognition) {
            this.recognition.start();
            this.addMessage("System", "ðŸŽ¤ Listening (Urdu)...");
         }
      });

      // LLM Modal Events
      document.getElementById("llmSettingsButton").addEventListener("click", () => {
         this.llmModal.classList.add("visible");
         if(this.llmConfig.apiKey || this.offlineLoaded) {
            this.llmLockStage.style.display = "none";
            this.llmConfigStage.style.display = "block";
            this.llmKeyInput.value = this.llmConfig.apiKey;
            this.llmModelInput.value = this.llmConfig.model;
         }
      });
      
      document.querySelector(".modal-close").addEventListener("click", () => this.llmModal.classList.remove("visible"));

      // Unlock Settings
      document.getElementById("llmUnlockBtn").addEventListener("click", () => {
         if(document.getElementById("llmPasswordInput").value === "6789"){
            this.llmLockStage.style.display = "none";
            this.llmConfigStage.style.display = "block";
         } else { alert("Wrong password"); }
      });

      // Save Cloud Settings
      document.getElementById("llmSaveBtn").addEventListener("click", () => {
         this.llmConfig.apiKey = this.llmKeyInput.value.trim();
         this.llmConfig.model = this.llmModelInput.value.trim();
         this.llmConfig.baseUrl = this.llmBaseUrlInput.value.trim();
         this.llmEnabled = true;
         this.saveState();
         alert("Cloud settings saved!");
      });

      // Clear Key
      document.getElementById("llmClearBtn").addEventListener("click", () => {
         this.llmConfig.apiKey = "";
         this.llmKeyInput.value = "";
         this.saveState();
         alert("Key cleared.");
      });

      // Offline Load Button
      this.offlineLoadBtn.addEventListener("click", () => this.handleOfflineLoad());
    }

    // âœ… Main Processing Hierarchy
    async handleSend(){
      const text = this.messageInput.value.trim();
      if(!text) return;
      this.addMessage("You", text);
      this.messageInput.value = "";

      // 1. Seed Check
      const seedMatch = this.seedRules.find(r => r.pattern.test(text));
      if(seedMatch){
        this.addMessage("AURA-X Î©", seedMatch.reply);
        return;
      }

      // 2. Intelligence Check (Fuzzy match simulation)
      const intelMatch = this.intelNodes.find(n => text.toLowerCase().includes(n.q.toLowerCase()));
      if(intelMatch){
        this.addMessage("AURA-X Î©", intelMatch.a + " (Learned)");
        return;
      }

      // 3. Offline LLM
      if(this.offlineLoaded && this.localLLMEngine){
        this.addMessage("System", "Thinking (Offline)...");
        try {
           const res = await this.localLLMEngine.chat.completions.create({
             messages: [{role:"user", content: text}]
           });
           this.addMessage("AURA-X Î©", res.choices[0].message.content);
           this.updateE0(0.1);
           return;
        } catch(e) { console.error(e); }
      }

      // 4. Cloud LLM
      if(this.llmConfig.apiKey){
        this.addMessage("System", "Thinking (Cloud)...");
        try {
           // Empty model name fallback
           const modelName = this.llmConfig.model || "gpt-4o-mini";
           const res = await fetch(this.llmConfig.baseUrl, {
             method: "POST",
             headers: { "Content-Type": "application/json", "Authorization": "Bearer " + this.llmConfig.apiKey },
             body: JSON.stringify({
               model: modelName,
               messages: [{role:"user", content: text}],
               max_tokens: 250
             })
           });
           const data = await res.json();
           if(data.error) throw new Error(data.error.message);
           this.addMessage("AURA-X Î©", data.choices[0].message.content);
           this.updateE0(0.1);
           return;
        } catch(e) {
           this.addMessage("System", "Cloud Error: " + e.message);
        }
      }

      // 5. Fallback / Learning Prompt
      this.addMessage("AURA-X Î©", "I don't know this yet. Teach me? (Feature coming soon)");
    }

    // âœ… Offline Engine Loader
    async handleOfflineLoad(){
      if(!navigator.gpu){
        this.offlineStatus.textContent = "Error: WebGPU not supported on this device.";
        return;
      }
      this.offlineLoadBtn.disabled = true;
      this.offlineStatus.textContent = "Initializing WebGPU...";
      
      try {
        this.localLLMEngine = await window.webllm.CreateMLCEngine(this.localModelId, {
          initProgressCallback: (p) => {
            this.offlineStatus.textContent = `Downloading: ${Math.round(p.progress * 100)}%`;
          }
        });
        this.offlineLoaded = true;
        this.offlineStatus.textContent = "Ready: TinyLlama is active (Offline).";
        this.offlineStatus.style.color = "#059669";
        this.offlineLoadBtn.style.display = "none";
      } catch(e) {
        this.offlineStatus.textContent = "Error: " + e.message;
        this.offlineLoadBtn.disabled = false;
      }
    }

    addMessage(sender, text){
      const div = document.createElement("div");
      div.className = "message " + (sender==="You"?"user-message":"ai-message");
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      this.chatContainer.appendChild(div);
      this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
    }

    updateE0(change){
      this.e0 = Math.tanh(this.e0 + change);
      this.metricE0.textContent = this.e0.toFixed(3);
    }

    saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        llmConfig: this.llmConfig,
        llmEnabled: this.llmEnabled,
        intelNodes: this.intelNodes,
        bmLayers: this.bmLayers
      }));
    }

    // Canvas Animation (Visuals)
    resizeCanvas(){
      this.bmCanvas.width = this.bmShell.offsetWidth;
      this.bmCanvas.height = this.bmShell.offsetHeight;
    }
    startBMAnimation(){
      const loop = () => {
        const w = this.bmCanvas.width;
        const h = this.bmCanvas.height;
        this.bmCtx.clearRect(0,0,w,h);
        const grad = this.bmCtx.createLinearGradient(0,0,0,h);
        grad.addColorStop(0,"#e0f2fe"); grad.addColorStop(1,"#cbd5e1");
        this.bmCtx.fillStyle = grad; this.bmCtx.fillRect(0,0,w,h);
        
        const barW = w / 240;
        for(let i=0; i<240; i++){
           this.bmLayers[i] += (Math.random()-0.5)*0.02;
           if(this.bmLayers[i]<0) this.bmLayers[i]=0;
           if(this.bmLayers[i]>1) this.bmLayers[i]=1;
           const barH = this.bmLayers[i] * h * 0.8;
           this.bmCtx.fillStyle = `rgba(56, 189, 248, 0.5)`;
           this.bmCtx.fillRect(i*barW, h-barH, barW, barH);
        }
        requestAnimationFrame(loop);
      };
      loop();
    }
  }

  window.addEventListener("DOMContentLoaded", () => {
    window.auraX = new AuraXOmegaEngine();
  });
})();
</script>
</body>
</html>
